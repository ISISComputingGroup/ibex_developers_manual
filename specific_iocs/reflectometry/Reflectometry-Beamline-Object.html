

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Beamline object &mdash; IBEX Developer&#39;s Manual</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=e6a88b47" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Beamline Parameters" href="Reflectometry-Beamline-Parameters.html" />
    <link rel="prev" title="Beam Blocker" href="Reflectometry-Beam-Blocker.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >

          
          
          <a href="../../index.html" class="icon icon-home">
            IBEX Developer's Manual
              <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Overview.html">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Editing-the-Wiki.html">Editing this Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Interfaces &amp; Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Client.html">IBEX GUI (Eclipse)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Script-Generator.html">Script Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Scripting.html">Scripting (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Web.html">Web Dashboard &amp; Chat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IBEX Server &amp; Systems</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../System-components.html">Backend System Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../IOCs.html">EPICS IOCs &amp; Support Modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../Specific-IOCs.html">Specific Devices &amp; IOCs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Cells.html">Cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Choppers.html">Choppers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Cryogenics.html">Cryogenics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DAE-and-the-ICP.html">DAE (Data Acquisition Electronics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DAQ.html">DAQ (NI cDAQ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Fluxgates.html">Fluxgates &amp; Magnetometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Gas-And-Liquid-Handling-Systems.html">Gas and liquid handling systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Imaging-Cameras.html">Imaging Cameras</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Loading-Rigs.html">Loading rigs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Magnets.html">Magnets &amp; Large Power Supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Motors.html">Motors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Motors-Extensions.html">Motor Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Multimeters.html">Multimeters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Other.html">Other / Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PLCs.html">PLCs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Polarisers-and-Analysers.html">Polarisers &amp; Analysers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Power-Distribution-Unit-%28PDU%29.html">Power distribution units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Power-Supplies.html">Power supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Pressure-Monitors.html">Pressure monitors</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../Reflectometry-IOC.html">Reflectometry</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Beamlines.html">Beamline-specific information</a></li>
<li class="toctree-l3"><a class="reference internal" href="Config-Training.html">Reflectometry Config Training</a></li>
<li class="toctree-l3"><a class="reference internal" href="Design-Docs.html">Reflectometry Design Documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="Reflectometers-Beam-Height-Calc.html">Beam height calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="Reflectometry-Alignment.html">Alignment</a></li>
<li class="toctree-l3"><a class="reference internal" href="Reflectometry-Beam-Blocker.html">Beam Blocker</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Beamline object</a></li>
<li class="toctree-l3"><a class="reference internal" href="Reflectometry-Beamline-Parameters.html">Beamline Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="Reflectometry-Composite-Driving-Layer.html">Composite Driving Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="Reflectometry-Configuration.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="Reflectometry-Geometry-Components.html">Geometry Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="Reflectometry-Glossary.html">Glossary</a></li>
<li class="toctree-l3"><a class="reference internal" href="Reflectometry-Testing.html">Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="Reflectometry-Troubleshooting-and-FAQ.html">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectometry-bench-configuration.html">Bench Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectometry_blind_script.html">Blind script</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectometry_blind_script_output.html">Blind script output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Rheometers.html">Rheometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Sample-Changers.html">Sample Changers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Sensors.html">Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Signal-Generators.html">Signal Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Temperature-Controllers.html">Temperature Controllers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Systems.html">Systems Administration &amp; Hardware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Processes &amp; Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Providing-Support.html">Providing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Deployment.html">Releases &amp; Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Processes.html">Processes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">IBEX Developer's Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../Specific-IOCs.html">Specific Devices &amp; IOCs</a></li>
          <li class="breadcrumb-item"><a href="../Reflectometry-IOC.html">Reflectometry</a></li>
      <li class="breadcrumb-item active">Beamline object</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/ibex_developers_manual/blob/master/doc/specific_iocs/reflectometry/Reflectometry-Beamline-Object.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="beamline-object">
<h1>Beamline object<a class="headerlink" href="#beamline-object" title="Link to this heading"></a></h1>
<p>The Beamline object is assembled in a python configuration file that lives in <code class="docutils literal notranslate"><span class="pre">&lt;INST&gt;/configurations/refl/config.py</span></code>.</p>
<p>This is the coordinating object for the system, it performs the correct movements based on the beamline parameters and mode which is currently active. The mode dictates which parameters are active in the calculation and preset values for any parameters. There are a number of modes which need to be supported in the system; for example NR mode, polarised, disabled etc. There is also a natural ordering of beamline parameters and components when it comes to calculations due to the direction of the beam, i.e. parameters for components closer to the source should be calculated before those further away as the latter have to be calculated relative to the changed beam path. For example the polarising mirror and all calculation to do with it should be done before the sample point calculations. The architecture is that a beamline object holds the order of both the components and beamline parameters. The composite drivers do not have a natural order but these are also contained by the beamline object. It makes sure that all calculations are done in the order in which they are held.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Beamline</span></code> object takes the following arguments:</p>
<section id="required">
<h2>Required:<a class="headerlink" href="#required" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">components</span></code>: A list of all <code class="docutils literal notranslate"><span class="pre">Component</span></code>s, ordered from beam start to beam stop</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">beamline_parameters</span></code>: A list of all <code class="docutils literal notranslate"><span class="pre">BeamlineParameter</span></code>s, ordered from beam start to beam stop</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">drivers</span></code>: A list of all <code class="docutils literal notranslate"><span class="pre">IocDriver</span></code>s, ordered from beam start to beam stop</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">modes</span></code>: A list of all <code class="docutils literal notranslate"><span class="pre">BeamlineMode</span></code>s</p></li>
</ul>
</section>
<section id="optional">
<h2>Optional:<a class="headerlink" href="#optional" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">incoming_beam</span></code>: The beam start node as a <code class="docutils literal notranslate"><span class="pre">PositionAndAngle</span></code>, i.e. the beam as it enters the blockhouse (Default: <code class="docutils literal notranslate"><span class="pre">PositionAndAngle(0,0,0)</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">footprint_setup</span></code>: The footprint setup to use (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">beamline_constants</span></code>: The list of <code class="docutils literal notranslate"><span class="pre">BeamlineConstants</span></code> (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li>
</ul>
<p>The following is a subsection of the configuration showing beamline parameters at the top, components in the middle and drivers at the bottom.</p>
<p><img alt="beamline diagram" src="../../_images/Beamline.png" /></p>
</section>
<section id="whole-beamline-move">
<h2>Whole Beamline Move<a class="headerlink" href="#whole-beamline-move" title="Link to this heading"></a></h2>
<p>When move for the whole beamline is triggered, the new positions of the motors are calculated using the following procedure.</p>
<ol class="arabic simple">
<li><p>Each of the sample parameters is considered in turn, going down the beam.</p></li>
<li><p>The beamline parameter is “moved to” if any of the following is true:</p>
<ul class="simple">
<li><p>the setpoint has been changed by the user</p></li>
<li><p>an init value for the current mode has been defined in the config and “apply inits on move” is enabled</p></li>
<li><p>it is in the current mode and a previous beamline parameter also in this mode has changed</p></li>
</ul>
</li>
<li><p>When the beamline parameter is “moved to” the result of the calculation will be passed down to the component it controls.</p>
<ol class="arabic simple">
<li><p>At this point the set point readback value will read the same as the set point</p></li>
<li><p>The component will then recalculate the beam path and instruct those components down beamline to recalculate their beam paths.</p></li>
</ol>
</li>
<li><p>Once all beamline parameters have finished calculating along with new component positions, the composite driving layer calculates the time taken for the slowest movement and performs the move in that time for all components.</p></li>
</ol>
</section>
<section id="single-beamline-parameter-move">
<h2>Single Beamline Parameter Move<a class="headerlink" href="#single-beamline-parameter-move" title="Link to this heading"></a></h2>
<p>When a single beamline parameter is set and moved on its own then:</p>
<p>If the beamline parameter is in the current mode:</p>
<ol class="arabic simple">
<li><p>Each beamline parameter in the mode is considered in turn, going down the beam starting from the beamline parameter which just moved.</p></li>
<li><p>If the parameter is in the mode the beamline parameter moves to its last set point (i.e. the one in the set point readback). This will pass down the calculation to the component it controls.</p></li>
<li><p>As above, the drivers then tell the motors to move.</p></li>
</ol>
<p>If it is not in the mode:</p>
<ol class="arabic simple">
<li><p>That beamline parameter sends its setpoint to the component it controls.</p></li>
<li><p>Then the beamline is recalculated</p></li>
<li><p>Motors are then moved</p></li>
</ol>
</section>
<section id="changing-the-mode">
<h2>Changing the Mode<a class="headerlink" href="#changing-the-mode" title="Link to this heading"></a></h2>
<p>When the mode is changed to (not disable mode) the following happens:</p>
<ol class="arabic simple">
<li><p>In beamline parameter order each pre-set is applied to the setpoint (but not moved to).</p>
<ol class="arabic simple">
<li><p>This includes setting whether the components are in the beam or not</p></li>
</ol>
</li>
<li><p>The parameters in the beamline are activated/deactivated as defined by the newly set mode.</p></li>
</ol>
</section>
<section id="reflectometry-disabled-mode">
<h2>Disabled Mode<a class="headerlink" href="#reflectometry-disabled-mode" title="Link to this heading"></a></h2>
<p>A mode can be declared as ”disabled mode” via parameter in its constructor. Disabled mode is special because in this mode the movements are relative to the positions when the mode was entered into. This is done by disabling the beam calculation for each component. The idea of disabled mode is to unlink all components from each other and stop tracking the beam path. Only theta related parameters should be in this mode, since theta is an angle between two components and by definition will not make sense if those are unlinked.</p>
</section>
<section id="reflectometry-beamline-constants">
<h2>Beamline Constants<a class="headerlink" href="#reflectometry-beamline-constants" title="Link to this heading"></a></h2>
<p>The beamline may also define constants: these are values set in the configuration file that the user wants exposed via a PV for the instrument, for example the Z coordinates of components, or the maximum Theta angle for this instrument. These can then be used in scripts like <code class="docutils literal notranslate"><span class="pre">run_angle</span></code>, for example to derive the distance between slits for footprint calculation. The value for the constant must be either a number or a boolean. They are set by passing them into the beamline object as an optional parameter.</p>
<p><strong>For more information on implementation specifics see the <a class="reference internal" href="Reflectometry-Configuration.html"><span class="doc std std-doc">Reflectometry Configuration page</span></a></strong></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Reflectometry-Beam-Blocker.html" class="btn btn-neutral float-left" title="Beam Blocker" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Reflectometry-Beamline-Parameters.html" class="btn btn-neutral float-right" title="Beamline Parameters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Oct 31, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>