

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Keithley 2700 &mdash; IBEX Developer&#39;s Manual</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=e6a88b47" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Keithley 6517B" href="Keithley-6517B.html" />
    <link rel="prev" title="Keithley 2420 (Polaris Thermoelectric cell)" href="Keithley-2420-%28POLARIS-Thermoelectric-cell%29.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >

          
          
          <a href="../../index.html" class="icon icon-home">
            IBEX Developer's Manual
              <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Overview.html">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Editing-the-Wiki.html">Editing this Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Interfaces &amp; Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Client.html">IBEX GUI (Eclipse)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Script-Generator.html">Script Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Scripting.html">Scripting (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Web.html">Web Dashboard &amp; Chat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IBEX Server &amp; Systems</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../System-components.html">Backend System Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../IOCs.html">EPICS IOCs &amp; Support Modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../Specific-IOCs.html">Specific Devices &amp; IOCs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Cells.html">Cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Choppers.html">Choppers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Cryogenics.html">Cryogenics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DAE-and-the-ICP.html">DAE (Data Acquisition Electronics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DAQ.html">DAQ (NI cDAQ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Fluxgates.html">Fluxgates &amp; Magnetometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Gas-And-Liquid-Handling-Systems.html">Gas and liquid handling systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Imaging-Cameras.html">Imaging Cameras</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Loading-Rigs.html">Loading rigs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Magnets.html">Magnets &amp; Large Power Supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Motors.html">Motors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Motors-Extensions.html">Motor Extensions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../Multimeters.html">Multimeters</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Keithley-2000.html">Keithley 2000</a></li>
<li class="toctree-l3"><a class="reference internal" href="Keithley-2001.html">Keithley 2001</a></li>
<li class="toctree-l3"><a class="reference internal" href="Keithley-2400.html">Keithley 2400</a></li>
<li class="toctree-l3"><a class="reference internal" href="Keithley-2420-%28POLARIS-Thermoelectric-cell%29.html">Keithley 2420 (Polaris Thermoelectric cell)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Keithley 2700</a></li>
<li class="toctree-l3"><a class="reference internal" href="Keithley-6517B.html">Keithley 6517B</a></li>
<li class="toctree-l3"><a class="reference internal" href="Keysight-E4980AL-LCR-Meter.html">Keysight (previously Agilent) E4980AL LCR Meter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Other.html">Other / Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PLCs.html">PLCs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Polarisers-and-Analysers.html">Polarisers &amp; Analysers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Power-Distribution-Unit-%28PDU%29.html">Power distribution units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Power-Supplies.html">Power supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Pressure-Monitors.html">Pressure monitors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Reflectometry-IOC.html">Reflectometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Rheometers.html">Rheometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Sample-Changers.html">Sample Changers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Sensors.html">Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Signal-Generators.html">Signal Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Temperature-Controllers.html">Temperature Controllers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Systems.html">Systems Administration &amp; Hardware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Processes &amp; Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Providing-Support.html">Providing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Deployment.html">Releases &amp; Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Processes.html">Processes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">IBEX Developer's Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../Specific-IOCs.html">Specific Devices &amp; IOCs</a></li>
          <li class="breadcrumb-item"><a href="../Multimeters.html">Multimeters</a></li>
      <li class="breadcrumb-item active">Keithley 2700</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/ibex_developers_manual/blob/master/doc/specific_iocs/multimeters/Keithley-2700.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="keithley-2700">
<h1>Keithley 2700<a class="headerlink" href="#keithley-2700" title="Link to this heading"></a></h1>
<p>The Keithley 2700 is a multimeter. There is no “general-purpose” IOC for this device, but there is an IOC in development for use with the 2700 on the HIFI CRYOMAG.</p>
<p>It can be used to measure many things including voltage and current (AC and DC) and resistance. On HIFI it measures the temperature at different locations on the cryomagnets. This is achieved by measuring resistances (using FRES measurement), then comparing these readings with a calibration file and interpolating a temperature value from this. It also calculates the temperature drift between measurements, in part to check the stability of the magnet.</p>
<p>The component in use on HIFI measures 20 channels, 101-110 and 201-210, and each of these channels can use a separate calibration file for interpolating the temperatures.</p>
<section id="setting-up-the-device">
<h2>Setting up the Device<a class="headerlink" href="#setting-up-the-device" title="Link to this heading"></a></h2>
<blockquote>
<div><p><strong>NOTE</strong> The IOC does work with a MOXA, but the legacy VI does <em>not</em>. If you intend to run it with a VI, it bust be done via a USB to RS232 adapter straight into your machine.</p>
</div></blockquote>
<p>Plug the device into the mains, and into a MOXA via its RS-232 port on the back.</p>
<p>Pressing the power button (lower left on the front panel) should make it turn on and beep.</p>
<p>Make sure that it is set up to use RS-232 - press (don’t hold) the shift key and press the enter key on the front panel. Make sure RS-232 is set to ON.</p>
<p>Make sure that the Keithley is using its rear measurement inputs. <code class="docutils literal notranslate"><span class="pre">REAR</span></code> should be displayed on the right edge of the display. If not, press the button on the right edge of the front panel, labelled <em>Front/Rear Inputs</em>.</p>
<p>Test that you can now talk to it by connecting to it via PuTTY or something similar, and sending it <code class="docutils literal notranslate"><span class="pre">*IDN?</span></code> and make sure you get the device name back.</p>
</section>
<section id="the-buffer">
<h2>The Buffer<a class="headerlink" href="#the-buffer" title="Link to this heading"></a></h2>
<blockquote>
<div><p>This section has been included because a lack of clear understanding of buffer operation has caused many issues during development</p>
</div></blockquote>
<p>The device features an on-board buffer which can be used to store measurements. It can store between 2 and 55,000 measurements, each of these can contain several bits of information including the actual measurement, the timestamp of the measurement, the channel it was taken from, and a few other parameters which can be found in the manual.</p>
<p>Setting the buffer size can be done using SCPI command <code class="docutils literal notranslate"><span class="pre">TRAC:POIN</span> <span class="pre">&lt;int&gt;</span></code> where int is an integer between 2 and 55,000. Note that the buffer is zero-indexed, so sending <code class="docutils literal notranslate"><span class="pre">TRAC:POIN</span> <span class="pre">10</span></code> sets up a buffer with index locations 0-9.</p>
<p>Use the SCPI command <code class="docutils literal notranslate"><span class="pre">TRAC:DATA:SEL?</span> <span class="pre">&lt;intX&gt;,&lt;intY&gt;</span></code> where <code class="docutils literal notranslate"><span class="pre">intX</span></code> is the starting index in the buffer that you wish to read from, and <code class="docutils literal notranslate"><span class="pre">intY</span></code> is the number of readings you wish to return. e.g. <code class="docutils literal notranslate"><span class="pre">TRAC:DATA:SEL?</span> <span class="pre">10,5</span></code> will return the stored readings at index locations 10,11,12,13,14. If there are no readings stored in any of those locations, the Keithley will produce error code -222, which is essentially an array out of bounds error. You also cannot set <code class="docutils literal notranslate"><span class="pre">intY</span></code> to 0, this will produce the same error. NOTE that the &lt;&gt; brackets are not needed in the command.</p>
<p>This is how the protocol file works, and you can also send these commands via a remote connection client like PuTTY. See the Keithley 2700 manual for a full list of supported SCPI commands.</p>
<section id="buffer-reading-logic">
<h3>Buffer Reading Logic<a class="headerlink" href="#buffer-reading-logic" title="Link to this heading"></a></h3>
<p>In the <code class="docutils literal notranslate"><span class="pre">COUNT:CALC</span></code> record in <code class="docutils literal notranslate"><span class="pre">keithley2700.db</span></code> there is a long logic statement designed to catch all cases when attempting to read from the buffer. The statement is:</p>
<p><code class="docutils literal notranslate"><span class="pre">(A&gt;=B)?(A-B):((A=0)?(C-B):A)</span></code></p>
<p>Where:</p>
<ul class="simple">
<li><p>A = the next <em>free</em> buffer location.</p></li>
<li><p>B = the buffer index to begin reading from.</p></li>
<li><p>C = the size (length) of the buffer.</p></li>
</ul>
<p>It calculates the number of readings to retrieve from the buffer.</p>
<p>The typical case is when <code class="docutils literal notranslate"><span class="pre">A&gt;=B</span></code>. In this case, the we want to retrieve from the starting index in the buffer up to the next free location (not inclusive). i.e. we start at index 0, the next <em>free</em> location is 2, so we retrieve 2-0 = 2 readings from the buffer, starting from index 0.</p>
<p>When ‘A&lt;B’ it means that either the buffer is full but there are still unretrieved readings, where A reports 0 (since that is the next location it would write to after clearing the buffer), or that the buffer has cleared and begun storing a new set of readings.</p>
<p>In the first case, we retrieve a count of <code class="docutils literal notranslate"><span class="pre">C-B</span></code> readings, which will give the number from the starting index position (B) to the end of the buffer. e.g. if the buffer length (C) is 10, and the starting index (B) is 8, we get 10-8 = 2 buffer readings to retrieve (at indices 8 and 9, since the buffer is 0-indexed).
In the second case, we have failed to retrieve the readings at the end of the buffer. This is because when the device begins writing a new set of readings it first clears the full buffer. In this case, we can only read the new set of readings, the count of which is A, starting from index 0.</p>
</section>
</section>
<section id="drift">
<h2>Drift<a class="headerlink" href="#drift" title="Link to this heading"></a></h2>
<p>The calculation used to calculate the drift uses information from the previous scan (including the previously calculated drift) and the information from the new scan.</p>
<blockquote>
<div><p>NOTE: the code contains a logic statement <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">((!isnan(temp_change_over_time))</span> <span class="pre">&amp;&amp;</span> <span class="pre">(isnan(previous_drift)))</span></code> which states that if the temp change over time exists (∆temp/∆time) and the previous drift does NOT exist (i.e. this is the first reading) then the new drift is just (∆temp/∆time) multiplied with the time constant. Otherwise, it is also summed with the previous drift factor</p>
</div></blockquote>
<p><img alt="drift-calculation" src="http://mathurl.com/y77q3ex2.png" /></p>
<p>Where</p>
<p><img alt="delta-temp" src="http://mathurl.com/ybcns6ud.png" /></p>
<p><img alt="delta-time" src="http://mathurl.com/y8lccdz7.png" /></p>
<p><img alt="d-n" src="http://mathurl.com/ydykpgb5.png" /></p>
<p><img alt="d-p" src="http://mathurl.com/ycpzu8wu.png" /></p>
</section>
<section id="interpolation">
<h2>Interpolation<a class="headerlink" href="#interpolation" title="Link to this heading"></a></h2>
<p>The Keithley utilises the <a class="reference internal" href="../../iocs/tools/Convert-Record.html"><span class="doc std std-doc">convert record</span></a> to interpolate a temperature from a resistance reading. It uses a Spline fit to do this, implemented in <code class="docutils literal notranslate"><span class="pre">User1DTableSub.c</span></code> in the support directory.</p>
<p>The setup part of this function includes an in-place swap of the data points in the y axis. This is because <code class="docutils literal notranslate"><span class="pre">csmbase</span></code> automatically sorts both axis of data points into ascending order, but maintains the links between an x data point and a y data point for use in the convert record’s built in interpolation functions.</p>
<p>After reading the calibration table, <code class="docutils literal notranslate"><span class="pre">csm</span></code> calls <code class="docutils literal notranslate"><span class="pre">coordinate_sort()</span></code> and <code class="docutils literal notranslate"><span class="pre">coordinate_update_backlinks()</span></code> on the x and y arrays. This calls <code class="docutils literal notranslate"><span class="pre">qsort</span></code> and puts them in ascending order (of value). <code class="docutils literal notranslate"><span class="pre">csm</span></code> relies on the index (stored in a struct with the actual data point) to determine which element in one array corresponds to the correct element in the other array, meaning that an array can be reordered without any problems arising because of this.</p>
<p>Because the user defined <code class="docutils literal notranslate"><span class="pre">User1DTableSub</span></code> does not utilise the <code class="docutils literal notranslate"><span class="pre">csm</span></code> back end (and therefore the data point links) the original order of the y axis must be preserved, so it is swapped back again in the in-place swap.</p>
<p>For a more thorough explanation, see <code class="docutils literal notranslate"><span class="pre">coordinate_sort()</span></code> and <code class="docutils literal notranslate"><span class="pre">coordinate_update_backlinks()</span></code> and the doc comments in <code class="docutils literal notranslate"><span class="pre">csmbase.c</span></code> (found in <code class="docutils literal notranslate"><span class="pre">C:\Instrument\Apps\EPICS\support\csm\master\csmApp</span></code>)</p>
</section>
<section id="unit-tests">
<h2>Unit Tests<a class="headerlink" href="#unit-tests" title="Link to this heading"></a></h2>
<p>The device utilises <a class="reference internal" href="../../iocs/testing/Setting-up-googleTest-to-work-with-EPICS-build-process.html"><span class="doc std std-doc">googletest</span></a> to test the drift functionality. It does this using real-world recorded values from a previous run. The tests can be found in the support directory for the Keithley, in <code class="docutils literal notranslate"><span class="pre">Keithley_2700Sup\tests</span></code> and can be run using <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> from the top level support directory, or using <code class="docutils literal notranslate"><span class="pre">run_tests.bat</span></code> for slightly more colourful output.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Keithley-2420-%28POLARIS-Thermoelectric-cell%29.html" class="btn btn-neutral float-left" title="Keithley 2420 (Polaris Thermoelectric cell)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Keithley-6517B.html" class="btn btn-neutral float-right" title="Keithley 6517B" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Oct 31, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>