

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RIKEN Power Supplies &mdash; IBEX Developer&#39;s Manual</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=e6a88b47" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="TDK Lambda Genesys" href="TDK-Lambda-Genesys.html" />
    <link rel="prev" title="NGPS Power Supply" href="NGPS-PSU.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >

          
          
          <a href="../../index.html" class="icon icon-home">
            IBEX Developer's Manual
              <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Overview.html">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Editing-the-Wiki.html">Editing this Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Interfaces &amp; Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Client.html">IBEX GUI (Eclipse)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Script-Generator.html">Script Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Scripting.html">Scripting (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Web.html">Web Dashboard &amp; Chat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IBEX Server &amp; Systems</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../System-components.html">Backend System Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../IOCs.html">EPICS IOCs &amp; Support Modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../Specific-IOCs.html">Specific Devices &amp; IOCs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Cells.html">Cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Choppers.html">Choppers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Cryogenics.html">Cryogenics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DAE-and-the-ICP.html">DAE (Data Acquisition Electronics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DAQ.html">DAQ (NI cDAQ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Fluxgates.html">Fluxgates &amp; Magnetometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Gas-And-Liquid-Handling-Systems.html">Gas and liquid handling systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Imaging-Cameras.html">Imaging Cameras</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Loading-Rigs.html">Loading rigs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../Magnets.html">Magnets &amp; Large Power Supplies</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Danfysik.html">Danfysik</a></li>
<li class="toctree-l3"><a class="reference internal" href="HIFI-Zero-field-controller.html">Zero field controller (HIFI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="HTS-Magnet.html">HTS Magnet</a></li>
<li class="toctree-l3"><a class="reference internal" href="MuSR-Steering-Magnets.html">MuSR Steering Magnets</a></li>
<li class="toctree-l3"><a class="reference internal" href="Muon-Active-Compensation.html">Muon Active Compensation</a></li>
<li class="toctree-l3"><a class="reference internal" href="Muon-NGS-Power-Supply-Firewall.html">Muon NGPS Power Supply Firewall</a></li>
<li class="toctree-l3"><a class="reference internal" href="NGPS-PSU.html">NGPS Power Supply</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">RIKEN Power Supplies</a></li>
<li class="toctree-l3"><a class="reference internal" href="TDK-Lambda-Genesys.html">TDK Lambda Genesys</a></li>
<li class="toctree-l3"><a class="reference internal" href="Transtechnik-Power-Supply.html">Transtechnik Power Supply</a></li>
<li class="toctree-l3"><a class="reference internal" href="Zero-field-controller.html">Zero field controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="Zero-field-controller-design.html">Zero field controller design</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Motors.html">Motors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Motors-Extensions.html">Motor Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Multimeters.html">Multimeters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Other.html">Other / Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PLCs.html">PLCs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Polarisers-and-Analysers.html">Polarisers &amp; Analysers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Power-Distribution-Unit-%28PDU%29.html">Power distribution units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Power-Supplies.html">Power supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Pressure-Monitors.html">Pressure monitors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Reflectometry-IOC.html">Reflectometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Rheometers.html">Rheometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Sample-Changers.html">Sample Changers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Sensors.html">Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Signal-Generators.html">Signal Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Temperature-Controllers.html">Temperature Controllers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Systems.html">Systems Administration &amp; Hardware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Processes &amp; Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Providing-Support.html">Providing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Deployment.html">Releases &amp; Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Processes.html">Processes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">IBEX Developer's Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../Specific-IOCs.html">Specific Devices &amp; IOCs</a></li>
          <li class="breadcrumb-item"><a href="../Magnets.html">Magnets &amp; Large Power Supplies</a></li>
      <li class="breadcrumb-item active">RIKEN Power Supplies</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/ibex_developers_manual/blob/master/doc/specific_iocs/magnets/RIKEN-Power-Supplies.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="riken-power-supplies">
<h1>RIKEN Power Supplies<a class="headerlink" href="#riken-power-supplies" title="Link to this heading"></a></h1>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading"></a></h2>
<p>The serial connections to the RIKEN Front End power supply units (PSUs) were previously made in four daisy chains, which all terminated at a single MOXA NPort (i.e. using four of its serial ports).  Since the refurbishment project (concluded December 2022) which replaced all of the PSUs with Danfysik units, the connections are now made in a <em>radial</em> fashion to each individual PSU using five MOXA NPort units placed strategically around the area.</p>
<p>See the <code class="docutils literal notranslate"><span class="pre">RIKENFE</span> <span class="pre">MOXA</span> <span class="pre">NPort</span> <span class="pre">Devices</span> <span class="pre">and</span> <span class="pre">IOCs</span></code> spreadsheet in the documentation area mentioned below for PSU &lt;-&gt; COM port &lt;-&gt; IOC mappings.</p>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading"></a></h2>
<p>The SharePoint site <a class="reference external" href="http://stfc365.sharepoint.com/sites/ISISExperimentControls/ICP%20Discussions/RIKEN%20FE"><code class="docutils literal notranslate"><span class="pre">Computing -&gt; ICPdiscussions</span> <span class="pre">-&gt;</span> <span class="pre">RIKEN</span> <span class="pre">FE</span></code></a> contains documentation relating to the refurbishment project.</p>
<p>The original documentation on the physical setup is at <code class="docutils literal notranslate"><span class="pre">\\...\shares\ISIS_Experiment_Controls\Manuals\RIKEN_power_supplies\</span></code> with some schematics in <code class="docutils literal notranslate"><span class="pre">riken</span> <span class="pre">psu</span> <span class="pre">controls</span> <span class="pre">-</span> <span class="pre">issue</span> <span class="pre">C.ppt</span></code>.  Most of the information in this area is now out-of-date, particularly that which describes the daisy-chain serial connections to the power supplies.  The remote <em>changeover</em> system (configuring RB2 magnet mode to direct beam to specific instruments), has now been removed entirely.</p>
</section>
<section id="iocs-and-macros">
<h2>IOCs and Macros<a class="headerlink" href="#iocs-and-macros" title="Link to this heading"></a></h2>
<p>Each of the individual Danfysik power supplies is controlled by an individual <a class="reference internal" href="Danfysik.html"><span class="doc std std-doc">Danfysik</span></a> IOC (i.e. a one-to-one mapping).  Each IOC is configured accordingly using its macro values, with a different COM port for each (as described above).</p>
<p>The RB2 PSU is <em>also</em> controlled by a Danfysik IOC (actually two - one for each board, see below).  Its protocol is very similar to a model 8500, and so the <code class="docutils literal notranslate"><span class="pre">DEVTYPE</span></code> macro is set to this, with the only difference being the command for setting the current.  Rather than writing an entirely separate protocol file, it was decided to create a <code class="docutils literal notranslate"><span class="pre">protocol_override</span></code> macro and set this to a file containing the single command definition.</p>
<p>The IBEX configuration contains several components, each of which relates to the type of magnet a group of PSUs control e.g. ‘Quadrupole’, ‘Bending’, ‘Crossfield’, etc.  (There is also a component for the 11 TPG300 units which control valves and read gauges in the vacuum system).</p>
</section>
<section id="hardware-notes">
<h2>Hardware notes<a class="headerlink" href="#hardware-notes" title="Link to this heading"></a></h2>
<section id="rb2-due-to-be-replaced-april-2023-with-standard-danfysik-units">
<h3>RB2 (<strong>Due to be replaced April 2023(?) with standard Danfysik units.</strong>)<a class="headerlink" href="#rb2-due-to-be-replaced-april-2023-with-standard-danfysik-units" title="Link to this heading"></a></h3>
<p><img alt="Annotated image of RIKEN RB2 PSU Front Panel" src="../../_images/RIKEN_RB2_Front_Panel.svg" /></p>
<ul class="simple">
<li><p>RB2 is a power supply that can be put into three distinct modes: BEND1 (beam goes one way), BEAM2 (the other way), and SEPTUM (beam splits both ways). RB2, although one physical supply, has two Danfysik-like control boards. The first control board (called “RB2” in our system) supplies current for either BEND1, BEND2, or half of SEPTUM mode. The second control board (“RB2_2” in our system) is <em>only</em> used to supply the other half of the current in SEPTUM mode.</p></li>
</ul>
<p><img alt="Annotated image of RIKEN RB2 PSU Control Boards" src="../../_images/RIKEN_RB2_Control_Boards.svg" /></p>
<ul class="simple">
<li><p>It is the only remaining original PSU from before the refurbishment project.  Its replacement(s) were not ready in time to be installed during the long shutdown, and so it has had to be integrated into the new connection topology.  Adapters were made to enable each control board to be directly connected to a MOXA NPort, rather than via a daisy chain as previously.  Wiring details of these adapters are in the document <code class="docutils literal notranslate"><span class="pre">RIKEN</span> <span class="pre">PSU</span> <span class="pre">Communications</span> <span class="pre">Cables</span></code> on the SharePoint site mentioned above.</p></li>
<li><p>The PSU itself is inside a restricted area, controlled by swipe access.  A Muon scientist, PSU group member, or MCR officer will need to be contacted should access be required.</p></li>
</ul>
</section>
</section>
<section id="debugging-troubleshooting">
<h2>Debugging &amp; Troubleshooting<a class="headerlink" href="#debugging-troubleshooting" title="Link to this heading"></a></h2>
<p>For Danfysik PSUs, see separate <a class="reference internal" href="Danfysik.html"><span class="doc std std-doc">Wiki Page</span></a> for more specific information.</p>
<section id="individual-danfysik-psu-won-t-talk-at-all">
<h3>Individual Danfysik PSU won’t talk at all<a class="headerlink" href="#individual-danfysik-psu-won-t-talk-at-all" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Check the PSU is powered on :wink:  The control mode should switch to <code class="docutils literal notranslate"><span class="pre">REMOTE</span></code> as soon as a command is received.</p></li>
<li><p>Check the serial cable - it can occasionally become loose. It is attached to the rear of each supply (with null modem) and can be accessed from the rear door of the rack.  There is also an RJ45 socket for each PSU in each rack.  This is where the MOXA serial lead connects to be patched back to the MOXA NPort unit, and is also worth checking.</p></li>
</ul>
</section>
<section id="rb2-psu-won-t-talk">
<h3>RB2 PSU won’t talk<a class="headerlink" href="#rb2-psu-won-t-talk" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Check that the PSU is powered on at the isolator on the EPB wall and at its own local switch under the front control panel.</p></li>
<li><p>Check that remote control mode is selected.  This is done by pressing the <code class="docutils literal notranslate"><span class="pre">COMP</span></code> switch in the <code class="docutils literal notranslate"><span class="pre">CONT.</span></code> section of the control panel.</p></li>
<li><p>Double check that the appropriate MOXA port(s) is/are set to RS-422 mode. <strong>This setting needs to be done in the MOXA itself (via the webpage) - IBEX can’t do it!</strong>  (See spreadsheet mentioned above for port information).</p></li>
</ul>
</section>
<section id="individual-psu-won-t-talk-sensibly-i-get-interleaved-replies-i-get-delayed-replies">
<h3>Individual PSU won’t talk sensibly / I get interleaved replies / I get delayed replies<a class="headerlink" href="#individual-psu-won-t-talk-sensibly-i-get-interleaved-replies-i-get-delayed-replies" title="Link to this heading"></a></h3>
<p>This can happen, we are not sure why. The PSU seems to get into a communications mode where it is using a different terminator (I think its terminator when it gets into this state is <code class="docutils literal notranslate"><span class="pre">\n\r\n\r\n\r</span></code>, and no, that isn’t a typo…).</p>
<p>The only (known) way to get out of this state is to power-cycle the power supply at its main switch.</p>
</section>
</section>
<section id="magnet-troubleshooting">
<h2>Magnet troubleshooting<a class="headerlink" href="#magnet-troubleshooting" title="Link to this heading"></a></h2>
<p>This section is from a document by James Lord; the original document on the manuals shared drive</p>
<section id="rb2">
<h3>RB2<a class="headerlink" href="#rb2" title="Link to this heading"></a></h3>
<p>Sometimes RB2_2 reads back implausible numbers such as 75000A. RB2 may also be wrong by a factor of 2. This is often because the IOC (or all of IBEX) has been restarted and the calibration factors for the power supply have been reset to default (which now corresponds to SEPTUM).</p>
<ul class="simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">inst.set_RB2_mode(mode,”CAL”)</span></code> with the mode that RB2 is in now.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">inst.set_beamline()</span></code> to re-send the setpoints.
Note that this procedure may briefly change the value of RB2, so it is best to pause any runs in progress. The restart of IBEX itself would not have affected the magnets.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="NGPS-PSU.html" class="btn btn-neutral float-left" title="NGPS Power Supply" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="TDK-Lambda-Genesys.html" class="btn btn-neutral float-right" title="TDK Lambda Genesys" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Oct 31, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>