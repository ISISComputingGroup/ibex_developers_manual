

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Muon Separator Power Supply &mdash; IBEX Developer&#39;s Manual</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=e6a88b47" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Data Streaming" href="../Datastreaming.html" />
    <link rel="prev" title="MuSR Rotation control" href="MuSR-Rotation-control.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >

          
          
          <a href="../../index.html" class="icon icon-home">
            IBEX Developer's Manual
              <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Overview.html">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Editing-the-Wiki.html">Editing this Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Interfaces &amp; Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Client.html">IBEX GUI (Eclipse)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Script-Generator.html">Script Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Scripting.html">Scripting (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Web.html">Web Dashboard &amp; Chat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IBEX Server &amp; Systems</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../System-components.html">Backend System Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../IOCs.html">EPICS IOCs &amp; Support Modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../Specific-IOCs.html">Specific Devices &amp; IOCs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Cells.html">Cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Choppers.html">Choppers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Cryogenics.html">Cryogenics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DAE-and-the-ICP.html">DAE (Data Acquisition Electronics)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../DAQ.html">DAQ (NI cDAQ)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="MuSR-Rotation-control.html">MuSR Rotation control</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Muon Separator Power Supply</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Datastreaming.html">Data Streaming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Fluxgates.html">Fluxgates &amp; Magnetometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Gas-And-Liquid-Handling-Systems.html">Gas and liquid handling systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Imaging-Cameras.html">Imaging Cameras</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Loading-Rigs.html">Loading rigs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Magnets.html">Magnets &amp; Large Power Supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Motors.html">Motors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Motors-Extensions.html">Motor Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Multimeters.html">Multimeters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Other.html">Other / Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PLCs.html">PLCs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Polarisers-and-Analysers.html">Polarisers &amp; Analysers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Power-Distribution-Unit-%28PDU%29.html">Power distribution units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Power-Supplies.html">Power supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Pressure-Monitors.html">Pressure monitors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Reflectometry-IOC.html">Reflectometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Rheometers.html">Rheometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Sample-Changers.html">Sample Changers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Sensors.html">Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Signal-Generators.html">Signal Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Temperature-Controllers.html">Temperature Controllers</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Processes &amp; Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Providing-Support.html">Providing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Deployment.html">Releases &amp; Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Processes.html">Processes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">IBEX Developer's Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../Specific-IOCs.html">Specific Devices &amp; IOCs</a></li>
          <li class="breadcrumb-item"><a href="../DAQ.html">DAQ (NI cDAQ)</a></li>
      <li class="breadcrumb-item active">Muon Separator Power Supply</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/ibex_developers_manual/blob/master/doc/specific_iocs/daq/Muon-Separator-Power-Supply.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="muon-separator-power-supply">
<h1>Muon Separator Power Supply<a class="headerlink" href="#muon-separator-power-supply" title="Link to this heading"></a></h1>
<p>The Muon Separator Power Supply is controlled by a National Instruments DAQ-Mx, since IBEX cannot communicate directly with the Separator PSU. The configuration for the DAQ is done in <code class="docutils literal notranslate"><span class="pre">EPICS\ioc\master\SEPRTR\iocBoot\iocSEPRTR-IOC-01\st-daq.cmd</span></code> There is further documentation on how the separator works <a class="reference external" href="https://stfc365.sharepoint.com/sites/ISISExperimentControls/ICP%20Discussions/Muon%20FE/Supporting%20the%20Muon%20Separator.pptx">here</a>.</p>
<p>The DAQ uses 4 AI ports and 4 AO ports used as such:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>AI Port</p></th>
<th class="head"><p>Use</p></th>
<th class="head"><p>—</p></th>
<th class="head"><p>AO Port</p></th>
<th class="head"><p>Use</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Read Kicker Voltage</p></td>
<td><p>—</p></td>
<td><p>0</p></td>
<td><p>Not used</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Read Kicker Current</p></td>
<td><p>—</p></td>
<td><p>1</p></td>
<td><p>Not used</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Read Separator Voltage</p></td>
<td><p>—</p></td>
<td><p>2</p></td>
<td><p>Set Separator Voltage</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Read Separator Current</p></td>
<td><p>—</p></td>
<td><p>3</p></td>
<td><p>Not used</p></td>
</tr>
</tbody>
</table>
<p>Each port sends or receives a voltage in the range 0-10V. The actual separator PSU operates between 0-200kV and 0-2.5mA, so some scaling is needed</p>
<p>The calibration (scaling) relationship is:</p>
<ul class="simple">
<li><p>Separator Voltage: 0-10V (DAQ) = 0-200kV (PSU)</p></li>
<li><p>Separator Current: 0-10V (DAQ) = 0-2.5mA (PSU)</p></li>
</ul>
<section id="separator-stability">
<h2>Separator stability<a class="headerlink" href="#separator-stability" title="Link to this heading"></a></h2>
<p>The calculation of the stability of the muon power supplies is calculated in two stages. First, the number of data points which lie out of the current and voltage stability boundaries is calculated from a sample set of data from the cDAQ. The record which calculates this is updated with every update from the voltage from the device, both voltage and current aren’t used to trigger this calculation as this could double count some data.</p>
<p>This data accumulates over one second until a timekeeper PV activates and sends the total number of data points which lie outside the stability boundary recorded in that second to a circular buffer. This buffer is kept in an aSub record, its default length is 600s (10 minutes).</p>
<p>To recover the amount of time which was spent outside of the stable boundary, multiply the number of samples collected by the time each sample represents, (1/sample frequency). This value is exposed in a PV for a nagios alarm to monitor.</p>
<p>The stability boundaries are defined as:</p>
<ol class="arabic simple">
<li><p>Voltage stability: <code class="docutils literal notranslate"><span class="pre">V_lower_limit</span> <span class="pre">&lt;</span> <span class="pre">V_measured</span> <span class="pre">&lt;</span> <span class="pre">V_upper_limit</span></code></p></li>
<li><p>Current stability: <code class="docutils literal notranslate"><span class="pre">I_measured</span> <span class="pre">&lt;=</span> <span class="pre">(I_stable</span> <span class="pre">+</span> <span class="pre">I_limit)</span></code></p></li>
</ol>
<p><strong>N.B</strong>: When the stability limits are set so that the signal is always unstable, then the unstable time will sometimes not equal the buffer size due to data loss. This will be a large problem if the frequency is larger than the number of elements.</p>
</section>
<section id="moving-average-filtering">
<h2>Moving average Filtering<a class="headerlink" href="#moving-average-filtering" title="Link to this heading"></a></h2>
<p>After installing the separator software on MUONFE, we found interference on the voltage input. To counter this, a filtering scheme was developed, described in the python notebooks here: <a class="reference external" href="https://github.com/ISISComputingGroup/separator-signal-analysis">https://github.com/ISISComputingGroup/separator-signal-analysis</a></p>
<p>This takes a moving average of two adjacent points, although a different stride length (number of indices between
the two points) of 20 was also considered. The stride length is currently a constant (1) in the c++ source, and the python test libraries</p>
<p>An aSub record to perform this is now referenced in the separator’s voltage db file. The data flow for voltage now looks like:</p>
<ol class="arabic simple">
<li><p>Raw data <code class="docutils literal notranslate"><span class="pre">$(P)DAQ:VOLT:_RAW</span></code></p></li>
<li><p>Calibration <code class="docutils literal notranslate"><span class="pre">$(P)_APPLYVOLTCALIB</span></code></p>
<ul class="simple">
<li><p>Calibrated data <code class="docutils literal notranslate"><span class="pre">$(P)CALIBRATE:VOLT</span></code></p></li>
</ul>
</li>
<li><p>Filtering <code class="docutils literal notranslate"><span class="pre">$(P)_APPLYVOLTFILTER</span></code></p>
<ul class="simple">
<li><p>Filtered Data <code class="docutils literal notranslate"><span class="pre">$(P)FILTERED:VOLT</span></code></p></li>
</ul>
</li>
</ol>
<p>To remove the filtering from the data flow, change the INAA field of <code class="docutils literal notranslate"><span class="pre">_STABILITYCHECK</span></code> in the separator stability db file to point at <code class="docutils literal notranslate"><span class="pre">$(P)CALIBRATE:VOLT</span></code>.</p>
<section id="data-loss-at-large-stride-lengths">
<h3>Data loss at large stride lengths<a class="headerlink" href="#data-loss-at-large-stride-lengths" title="Link to this heading"></a></h3>
<p>As a consequence of performing a moving average, the shape of voltage input data is reduced by the stride length. This means that there will be fewer data points than the (unfiltered) current data, so the assumption of the separator stability calculation that there are the same number of points for both current and voltage is no longer valid. It was decided that a stride length of 1 does not ‘stretch out’ the voltage trace enough to break the assumption. A longer stride length (e.g. 20) would be a significant source of error and need to be addressed.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="MuSR-Rotation-control.html" class="btn btn-neutral float-left" title="MuSR Rotation control" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../Datastreaming.html" class="btn btn-neutral float-right" title="Data Streaming" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Feb 27, 2026.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>