

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Beckhoff IOC Architecture &mdash; IBEX Developer&#39;s Manual</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=e6a88b47" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Beckhoff commissioning" href="Beckhoff-commissioning.html" />
    <link rel="prev" title="Beckhoff" href="../Beckhoff.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            IBEX Developer's Manual
              <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Overview.html">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Editing-the-Wiki.html">Editing this Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Interfaces &amp; Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Client.html">IBEX GUI (Eclipse)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Script-Generator.html">Script Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Scripting.html">Scripting (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Web.html">Web Dashboard &amp; Chat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IBEX Server &amp; Systems</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../System-components.html">Backend System Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../IOCs.html">EPICS IOCs &amp; Support Modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../Specific-IOCs.html">Specific Devices &amp; IOCs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../Cells.html">Cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Choppers.html">Choppers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Cryogenics.html">Cryogenics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../DAE-and-the-ICP.html">DAE (Data Acquisition Electronics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../DAQ.html">DAQ (NI cDAQ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Fluxgates.html">Fluxgates &amp; Magnetometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Gas-And-Liquid-Handling-Systems.html">Gas and liquid handling systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Imaging-Cameras.html">Imaging Cameras</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Loading-Rigs.html">Loading rigs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Magnets.html">Magnets &amp; Large Power Supplies</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../Motors.html">Motors</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../Attocube.html">Attocube</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../Beckhoff.html">Beckhoff</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Beckhoff IOC Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="Beckhoff-commissioning.html">Beckhoff commissioning</a></li>
<li class="toctree-l4"><a class="reference internal" href="Beckhoff-testing.html">Beckhoff testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="Beckhoff-troubleshooting.html">Beckhoff troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../EnginX-Sample-Positioner.html">EnginX Sample Positioner</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Galil.html">Galil</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Linmot.html">Linmot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../McLennan-motors.html">McLennan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Newport.html">Newport</a></li>
<li class="toctree-l3"><a class="reference internal" href="../PI-Rotation-Stage-setup.html">PI Rotation Stage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../SMC100.html">SMC100</a></li>
<li class="toctree-l3"><a class="reference internal" href="../SXD-Attocube.html">SXD Attocube</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Motors-Trouble-Shooting.html">Motors Trouble Shooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Adding-motor-IOC-to-global-motor-moving-and-stop-all.html">Add motor to global moving and stop all</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Clearing-the-Motors-are-Moving-state.html">Clearing the “motors moving” state</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Set-the-raw-position-of-the-motor-without-moving-it.html">Set the raw position of the motor without moving it</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Add-support-for-motor-extras.html">Add support for motor extras</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../Motors-Extensions.html">Motor Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Multimeters.html">Multimeters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Other.html">Other / Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../PLCs.html">PLCs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Polarisers-and-Analysers.html">Polarisers &amp; Analysers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Power-Distribution-Unit-%28PDU%29.html">Power distribution units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Power-Supplies.html">Power supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Pressure-Monitors.html">Pressure monitors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Reflectometry-IOC.html">Reflectometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Rheometers.html">Rheometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Sample-Changers.html">Sample Changers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Sensors.html">Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Signal-Generators.html">Signal Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Temperature-Controllers.html">Temperature Controllers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Systems.html">Systems Administration &amp; Hardware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Processes &amp; Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Providing-Support.html">Providing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Deployment.html">Releases &amp; Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Processes.html">Processes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">IBEX Developer's Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../Specific-IOCs.html">Specific Devices &amp; IOCs</a></li>
          <li class="breadcrumb-item"><a href="../../Motors.html">Motors</a></li>
          <li class="breadcrumb-item"><a href="../Beckhoff.html">Beckhoff</a></li>
      <li class="breadcrumb-item active">Beckhoff IOC Architecture</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/ibex_developers_manual/blob/master/doc/specific_iocs/motors/beckhoff/Beckhoff-architecture.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="beckhoff-ioc-architecture">
<h1>Beckhoff IOC Architecture<a class="headerlink" href="#beckhoff-ioc-architecture" title="Link to this heading"></a></h1>
<p><a class="reference external" href="https://github.com/ISISComputingGroup/EPICS-ioc/tree/master/TC">TC</a> is the IOC responsible for communication with Beckhoff PLCs at ISIS.</p>
<p>At IOC startup, it uses <a class="reference external" href="https://github.com/ISISComputingGroup/adsDriver/blob/71a3404bd266cc260ff8802e1a1c017be09dbef4/adsApp/src/ioc_commands.cpp#L139-L199">a command</a> to get the number of motion axes. Note that this may be more than 8, in which case we have to use <a class="reference external" href="https://github.com/ISISComputingGroup/EPICS-ioc/blob/2ae20fd5997457a48469ced80f377eaaa49935b3/TC/iocBoot/iocTC-IOC-01/st-common.lua#L51-L55">some logic</a> to alias <code class="docutils literal notranslate"><span class="pre">MTR0109</span></code> to <code class="docutils literal notranslate"><span class="pre">MTR0201</span></code> so we can display it in the IBEX GUI’s table of motors.</p>
<p>We have an EPICS motor record implementation which TC uses that interfaces some intermediate PVs, spun up <a class="reference external" href="https://github.com/ISISComputingGroup/EPICS-ioc/blob/97e2bd77c5909ff2f1b6c0cda7f175366b379102/TC/iocBoot/iocTC-IOC-01/st-common.lua#L30">at runtime</a> per-axis by AdsDriver using <a class="reference external" href="https://github.com/ISISComputingGroup/EPICS-motorExtensions/tree/master/beckhoffApp">the Beckhoff Motor Extensions</a>  <code class="docutils literal notranslate"><span class="pre">.db</span></code> files.</p>
<p>This was originally done so we could drop in <a class="reference external" href="https://github.com/ISISComputingGroup/adsDriver"><code class="docutils literal notranslate"><span class="pre">AdsDriver</span></code></a> in place of another ADS EPICS module (<a class="reference external" href="https://github.com/ISISComputingGroup/EPICS-tcIoc"><code class="docutils literal notranslate"><span class="pre">tcIOC</span></code></a>) and debug EPICS to ADS communications more easily by bypassing the motor modules if we saw an issue. In the future, we could build <a class="reference external" href="https://github.com/ISISComputingGroup/adsDriver"><code class="docutils literal notranslate"><span class="pre">AdsDriver</span></code></a> calls into our motor module directly so we avoid this extra step. We still need to use <code class="docutils literal notranslate"><span class="pre">AdsDriver</span></code> to spin up extra, instrument-specific PVs - <a class="reference internal" href="Beckhoff-commissioning.html#beckhoff-arbitrary-fields"><span class="std std-ref">Arbitrary fields</span></a></p>
<p>This means that the EPICS motor record is essentially doing <code class="docutils literal notranslate"><span class="pre">dbgf</span></code> and <code class="docutils literal notranslate"><span class="pre">dbpf</span></code> as documented in the <a class="reference external" href="https://docs.epics-controls.org/en/latest/appdevguide/IOCTestFacilities.html" title="(in EPICS Documentation)"><span class="xref std std-doc">EPICS IOC Test Facilities</span></a> respectively to read and write to these PVs, rather than just setting something on a device like a normal motion controller like a <a class="reference internal" href="../McLennan-motors.html"><span class="doc">McLennan</span></a> or <a class="reference internal" href="../Galil.html"><span class="doc">Galil</span></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">TC</span></code> also does some things “outside” the motor record such as forwarding the device’s velocities to the motor record. This is because the PLC is commissioned with a sensible velocity in most cases and we don’t want to overwrite this information, and it may change on the PLC due to safety system overloads and so on. We also do the same for axis description (to the <code class="docutils literal notranslate"><span class="pre">.DESC</span></code> field) - see <a class="reference internal" href="Beckhoff-commissioning.html#beckhoff-manual-commission-step"><span class="std std-ref">Fields that aren’t automatically populated</span></a>.</p>
<section id="beckhoff-config-area">
<h2>Beckhoff config area<a class="headerlink" href="#beckhoff-config-area" title="Link to this heading"></a></h2>
<p>The config area contains a directory used for storing <code class="docutils literal notranslate"><span class="pre">.cmd</span></code> files for use with the <code class="docutils literal notranslate"><span class="pre">TC</span></code> IOC (in the same way as a galil or other motor controller). On an instrument it should look like this: <code class="docutils literal notranslate"><span class="pre">\instrument\apps\EPICS\support\motorExtensions\master\settings\&lt;instname&gt;\twincat\</span></code>.</p>
</section>
<section id="quirks">
<h2>Quirks<a class="headerlink" href="#quirks" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>The Beckhoff uses whether it has been homed to set <code class="docutils literal notranslate"><span class="pre">ATHM</span></code> in the motor record, rather than just using the raw datum switch. This is different to a Galil which uses the datum switch.</p></li>
<li><p>The “limits” shown on the table of motors summary view are not necessarily actual physical limit switches being engaged - the Beckhoff has more complex rules on whether motors can move back or forwards.</p></li>
<li><p>The motor record sets <code class="docutils literal notranslate"><span class="pre">UEIP</span></code> (use encoder if present) to false to avoid using the encoder resolution to scale values. We have no control over whether to use or not use an encoder with a Beckhoff, the internal code handles it. As well as this, we do not retry (<code class="docutils literal notranslate"><span class="pre">.RCNT</span></code> and <code class="docutils literal notranslate"><span class="pre">.RDBD</span></code> fields of the motor record) as the motion control loop is handled by the PLC.</p></li>
<li><p>Some Beckhoff axes are virtual as the PLC can handle kinematics, for example many of the INTER axes. There isn’t currently a way to differentiate real and virtual axes other than marking them with <code class="docutils literal notranslate"><span class="pre">v</span> <span class="pre">-</span> </code> in their <code class="docutils literal notranslate"><span class="pre">.DESC</span></code> fields.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../Beckhoff.html" class="btn btn-neutral float-left" title="Beckhoff" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Beckhoff-commissioning.html" class="btn btn-neutral float-right" title="Beckhoff commissioning" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Oct 31, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>