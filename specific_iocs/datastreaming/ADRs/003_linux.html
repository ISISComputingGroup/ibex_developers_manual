

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3 - Linux &mdash; IBEX Developer&#39;s Manual</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=e6a88b47" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="4 - Vetos and Run control" href="004_vetos_runcontrol.html" />
    <link rel="prev" title="2 - Wiring and Spectra mapping" href="002_spectra_mapping.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            IBEX Developer's Manual
              <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Overview.html">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Editing-the-Wiki.html">Editing this Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Interfaces &amp; Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Client.html">IBEX GUI (Eclipse)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Script-Generator.html">Script Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Scripting.html">Scripting (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Web.html">Web Dashboard &amp; Chat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IBEX Server &amp; Systems</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../System-components.html">Backend System Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../IOCs.html">EPICS IOCs &amp; Support Modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../Specific-IOCs.html">Specific Devices &amp; IOCs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../Cells.html">Cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Choppers.html">Choppers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Cryogenics.html">Cryogenics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../DAE-and-the-ICP.html">DAE (Data Acquisition Electronics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../DAQ.html">DAQ (NI cDAQ)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../Datastreaming.html">Data Streaming</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../ADRs.html">Data streaming: ADRs</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="000_kafka.html">0 - Kafka</a></li>
<li class="toctree-l4"><a class="reference internal" href="001_histograms.html">1 - Histograms and event mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="002_spectra_mapping.html">2 - Wiring and Spectra mapping</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">3 - Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="004_vetos_runcontrol.html">4 - Vetos and Run control</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../Datastreaming---File-writing.html">Data streaming: File writing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Datastreaming---Sample-Environment.html">Data streaming: Sample environment forwarding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Datastreaming--neutron-events-histograms.html">Data streaming: Neutron events and histograms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Datastreaming-How-To.html">Data streaming: how-to guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Datastreaming-Topics.html">Data streaming: topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Datastreaming-hardware-architecture.html">Data streaming: hardware architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Datastreaming-run-starts-stops.html">Data streaming: run starts/stops</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../Fluxgates.html">Fluxgates &amp; Magnetometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Gas-And-Liquid-Handling-Systems.html">Gas and liquid handling systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Imaging-Cameras.html">Imaging Cameras</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Loading-Rigs.html">Loading rigs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Magnets.html">Magnets &amp; Large Power Supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Motors.html">Motors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Motors-Extensions.html">Motor Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Multimeters.html">Multimeters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Other.html">Other / Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../PLCs.html">PLCs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Polarisers-and-Analysers.html">Polarisers &amp; Analysers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Power-Distribution-Unit-%28PDU%29.html">Power distribution units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Power-Supplies.html">Power supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Pressure-Monitors.html">Pressure monitors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Reflectometry-IOC.html">Reflectometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Rheometers.html">Rheometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Sample-Changers.html">Sample Changers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Sensors.html">Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Signal-Generators.html">Signal Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Temperature-Controllers.html">Temperature Controllers</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Processes &amp; Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Providing-Support.html">Providing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Deployment.html">Releases &amp; Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Processes.html">Processes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">IBEX Developer's Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../Specific-IOCs.html">Specific Devices &amp; IOCs</a></li>
          <li class="breadcrumb-item"><a href="../../Datastreaming.html">Data Streaming</a></li>
          <li class="breadcrumb-item"><a href="../ADRs.html">Data streaming: ADRs</a></li>
      <li class="breadcrumb-item active">3 - Linux</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/ibex_developers_manual/blob/master/doc/specific_iocs/datastreaming/ADRs/003_linux.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="linux">
<h1>3 - Linux<a class="headerlink" href="#linux" title="Link to this heading"></a></h1>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Link to this heading"></a></h2>
<p>Accepted.</p>
</section>
<section id="context">
<h2>Context<a class="headerlink" href="#context" title="Link to this heading"></a></h2>
<p>Historically we have used Windows for running most of our software due to LabVIEW support when migrating from SECI.
This often means software is not natively supported as most of the wider experiment controls community at comparable facilities run Linux instead, so we regularly have to port software designed for Linux to run on Windows.</p>
<p>Streaming software is linux-centric and running Kafka itself natively on Windows is not natively supported by either <a class="reference external" href="https://www.confluent.io/blog/set-up-and-run-kafka-on-windows-linux-wsl-2/#:~:text=Windows%20still%20isn%E2%80%99t%20the%20recommended%20platform%20for%20running%20Kafka%20with%20production%20workloads">confluent Kafka</a> or <a class="reference external" href="https://docs.redpanda.com/current/get-started/quick-start/#:~:text=If%20you%E2%80%99re,Linux%20%28WSL%29%2E">redpanda</a>. In addition, a number of tools developed both externally and at ISIS for data streaming only currently run on Linux.</p>
<p>Running software under WSL is an option, but is not <a class="reference external" href="https://learn.microsoft.com/en-us/windows/wsl/faq#can-i-use-wsl-for-production-scenarios-">built for production use.</a> It also adds several layers of complexity with networking, file systems and so on. Container networking configuration is difficult and limited using WSL.</p>
<p>We would ideally like to run the data streaming software in containers as they offer security, deployment and repeatability benefits and are extremely popular in the software development industry. HRPD-X coming online with a new detector technology means that we will need to be able to easily apply new versions of data-streaming software at short notice. Containers give us an easy, repeatable path to be able to do this.</p>
<p>Docker Desktop <em>is</em> supported on Windows, but uses the WSL with a strict licensing agreement which does not suit our needs. Other alternatives also use the WSL. Many container configuration options (e.g. host networking, volume mounting options) cannot be supported with containers on Windows (whether via Docker desktop or another solution).</p>
<p>One of the long-term goals on the Experiment Controls road-map is to revisit our operating system choice. It is very likely this will be a distribution of Linux.</p>
<p>For HRPD-X specifically, the NDX and NDH is unsuitable for deploying data streaming software, as it will remain using Windows (in the short term).</p>
<p>Additionally, Windows Licensing costs have recently changed significantly (as of January 2026). If we chose to use a Linux distribution, even with support ie. in the style of Red Hat Enterprise Linux, it is likely it would cost less.</p>
<p>ISIS has made it clear that Linux support will be provided in the medium term.</p>
<p>There are a few different options with associated risks and benefits:</p>
<section id="running-natively-on-the-windows-ndx-machines">
<h3>1 - Running natively on the (Windows) NDX machines<a class="headerlink" href="#running-natively-on-the-windows-ndx-machines" title="Link to this heading"></a></h3>
<p>This has the benefit that everything runs along with the rest of IBEX, though we would have to spend extra development effort trying to port software to Windows which we may undo in the future if moving to Linux anyway.</p>
<p>The NDX already exists so doesn’t add any system administration requirements to be able to run the software.</p>
<p>The main drawbacks for this approach are that:</p>
<ul class="simple">
<li><p>the NDXes do not have sufficient resources for the software currently</p></li>
<li><p>Windows is different to everyone else running the streaming software, and we may waste effort porting software to Windows</p></li>
<li><p>Kafka itself will not run on Windows</p></li>
<li><p>Deployment and patching will become difficult for a system which will need to be patched frequently and will interfere with the rest of the control system. As an example, we do not use virtual environments in python, so updating a python dependency for the <code class="docutils literal notranslate"><span class="pre">forwarder</span></code> runs the risk that it may break something in user scripts and/or the block server, which would be very bad.</p></li>
<li><p>Task scheduling/service management can be difficult on Windows, we could use <code class="docutils literal notranslate"><span class="pre">procserv</span></code> but in most cases we don’t require an interactive terminal for processes.</p></li>
<li><p>Moving away from Windows is on the road-map - we would be creating more work for ourselves when we migrate over eventually.</p></li>
</ul>
</section>
<section id="running-natively-on-a-separate-linux-machine">
<h3>2 - Running natively on a separate Linux machine<a class="headerlink" href="#running-natively-on-a-separate-linux-machine" title="Link to this heading"></a></h3>
<p>This adds another machine in the data streaming stack which <em>could</em> fail and stop data collection.</p>
<p>Running the streaming software (which is designed to be run on Linux) natively would be the most performant of all the approaches.</p>
<p>The main benefit to this is that we can specify the hardware requirements independently so they are suitable for the streaming software, with enough overhead to run Kafka on if needed.</p>
<p>Tooling is generally more available for deployment and patching than Windows, however this is not something we are familiar with as a team.</p>
<p>The downside is that if the setup of this machine isn’t entirely automated it could be very difficult to maintain and/or reproduce if a hardware failure occurred.</p>
<p>As well as this, more Linux system administration knowledge is required by the team.</p>
<p>Operating system updates could inadvertently affect the processes running on the machine, which could cause issues if we set the system to install unattended upgrades.</p>
</section>
<section id="running-in-containers-on-the-ndx-machines">
<h3>3 - Running in containers on the NDX machines<a class="headerlink" href="#running-in-containers-on-the-ndx-machines" title="Link to this heading"></a></h3>
<p>The benefit of doing this is that all services can be brought up and down together with the rest of the control system. It is also one less link in the data streaming chain to fail.</p>
<p>This would require the use of the WSL which is not specifically designed for production use and has limited functionality with containers due to host-network mode issues and so on.
NDXes are virtualised and have <em>very</em> limited resources.</p>
<p>Another drawback is that we currently the current IBEX deployment method makes it difficult to patch these services as easily - moving these services elsewhere means we do not have to interrupt e.g. sample environment scripts to restart/redeploy new versions of DAE processes.</p>
<p>We are unable to use Docker desktop, required for docker engine on Windows, without paid licensing. An alternative is Rancher Desktop or podman. These both use underlying VMs.</p>
</section>
<section id="running-in-containers-on-a-linux-vm-on-the-ndh">
<h3>4 - Running in containers on a Linux VM on the NDH<a class="headerlink" href="#running-in-containers-on-a-linux-vm-on-the-ndh" title="Link to this heading"></a></h3>
<p>This has the same benefits as above but would allow us to run a Linux VM alongside the NDX which lets us avoid WSL oddities.
Additionally, there should be more flexibility in deployment and patching, and less interference with the rest of IBEX.</p>
<p>NDHes are currently very limited on resources, much like the NDXes which run on them. This is the main sticking point for this approach.</p>
<p>Alongside this, virtual machines do generally introduce a performance penalty - the exact figure for this depends on several factors but it will never be as fast as a native application or a container which shares the kernel. For fast processes such as live histogramming and event processing we may require high performance which could be limited by a virtual machine.</p>
</section>
<section id="running-in-containers-on-a-separate-linux-machine">
<h3>5 - Running in containers on a separate Linux machine<a class="headerlink" href="#running-in-containers-on-a-separate-linux-machine" title="Link to this heading"></a></h3>
<p>This adds another machine in the data streaming stack which <em>could</em> fail and stop data collection.
As well as this, it will rely on the instrument’s local network switch, which could also fail (though this is applicable to any of the options as the WLSF boards will be streaming over this switch)</p>
<p>Another downside, which affects the above approach, is that some system administration knowledge will be required to keep the operating system alive and secure. If we are using containers this should be very minimal.</p>
<p>This shares the benefit of being able to specify suitable hardware requirements as approach 2.</p>
<p>Containers are much more easily reproducible than native software. The wider industry is moving towards them generally because of this amongst other reasons.</p>
<p>Deployment, patching and orchestration is also very widely supported by several frameworks with containers. We should decide exactly what we’re doing at a later point, but if we started with <a class="reference external" href="https://docs.docker.com/compose/"><code class="docutils literal notranslate"><span class="pre">docker-compose</span></code></a> as a simple first step, it is straightforward to move towards something like <a class="reference external" href="https://kubernetes.io/">Kubernetes</a> instead if we decide we need the features it offers.</p>
<p>Containers also provide a cyber-security benefit in that the processes are isolated individually.</p>
<p>DSG already have some container-based software to convert UDP streams to Flatbuffers blobs - we could quite easily host this for them if we have container infrastructure. This applies to any of the approaches that offer it.</p>
<p>If we end up being responsible for running the Kafka instance for HRPD-x, adding this is straightforward - Redpanda and the other Kafka implementations all offer production-ready container images.</p>
</section>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Link to this heading"></a></h2>
<p>New hardware, running Linux, will be used to run the streaming software as shown <a class="reference internal" href="../Datastreaming-hardware-architecture.html#ds-hardware-architecture"><span class="std std-ref">here</span></a>.</p>
<p>Wherever possible, software will be deployed in containers, which will minimise the amount of Linux systems administration knowledge required. The aim will be for the Linux machine to ‘only’ have a container engine (such as docker or podman) installed, and very little else. Containers will use health checks and auto-restarting to ensure reliability. We will decide on exact deployment and orchestration methods later on, but there are several approaches to choose from.</p>
<p>Exact specifications will depend on data rates and prototype testing.</p>
</section>
<section id="consequences">
<h2>Consequences<a class="headerlink" href="#consequences" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>We are able to use Linux-centric technologies and tools, without needing to spend large amounts of time inventing workarounds for Windows.</p></li>
<li><p>The OS will be different. Developers will need <em>some</em> understanding of Linux to maintain these servers.</p>
<ul>
<li><p>Mitigation: do as little as possible on the host, ideally limit it to just having a container engine installed via a configuration management tool such as Ansible. Some Linux distributions come with this out of the box such as <a class="reference external" href="https://docs.fedoraproject.org/en-US/fedora-coreos/">Fedora CoreOS</a> or <a class="reference external" href="https://rancher.com/docs/os/v1.x/en/">RancherOS</a></p></li>
</ul>
</li>
<li><p>Data-streaming infrastructure will not be on the NDH/NDX machine with the rest of IBEX. This is fine - EPICS is explicitly designed to run in a distributed way.</p></li>
<li><p>We will need to carefully consider the system specification of the Linux server in order to ensure it is adequate for expected data rates (including data rates from e.g. noisy detectors, to a point). In particular we expect to need to carefully consider:</p>
<ul>
<li><p>Disk write performance (for the Kafka broker and the filewriter)</p></li>
<li><p>Network interface speeds (both from the electronics into this server, and from this server onwards to consumers such as Mantid)</p></li>
<li><p>Memory (for any processes which need to histogram the data - must be able to keep a histogram in memory)</p></li>
<li><p>Performance headroom for foreseeable future processes which may need to run on this machine</p></li>
<li><p>The expected lifetime of the machine, which will have impacts on the spec chosen; expecting a longer lifetime will necessarily mean a higher up-front specification</p></li>
</ul>
</li>
<li><p>The data streaming stack will be unaffected by a restart of the NDX system, and will keep running in the background.</p></li>
<li><p>We will configure the relevant containers for data streaming software to automatically start on reboot of the data streaming Linux server.</p></li>
</ul>
<p>The above will be impacted if we are required to run a Kafka instance on the streaming machine - this is unclear as of January 2026. Redpanda provides <a class="reference external" href="https://docs.redpanda.com/current/deploy/redpanda/manual/production/requirements/">some documentation on hardware requirements</a> which we should consider.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="002_spectra_mapping.html" class="btn btn-neutral float-left" title="2 - Wiring and Spectra mapping" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="004_vetos_runcontrol.html" class="btn btn-neutral float-right" title="4 - Vetos and Run control" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Feb 27, 2026.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>