

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mercury IPS &mdash; IBEX Developer&#39;s Manual</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=e6a88b47" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Triton" href="Triton.html" />
    <link rel="prev" title="IPS" href="Oxford-Instruments-IPS.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >

          
          
          <a href="../../index.html" class="icon icon-home">
            IBEX Developer's Manual
              <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Overview.html">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Editing-the-Wiki.html">Editing this Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Interfaces &amp; Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Client.html">IBEX GUI (Eclipse)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Script-Generator.html">Script Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Scripting.html">Scripting (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Web.html">Web Dashboard &amp; Chat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IBEX Server &amp; Systems</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../System-components.html">Backend System Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../IOCs.html">EPICS IOCs &amp; Support Modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../Specific-IOCs.html">Specific Devices &amp; IOCs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Cells.html">Cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Choppers.html">Choppers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../Cryogenics.html">Cryogenics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="2T-3D-Vector-magnet.html">Scientific Magnetics 2T 3D Vector Magnet</a></li>
<li class="toctree-l3"><a class="reference internal" href="CP2800-Compressors.html">CP2800 Compressors</a></li>
<li class="toctree-l3"><a class="reference internal" href="Cryogenic-SMS-PSU.html">Cryosms PSU</a></li>
<li class="toctree-l3"><a class="reference internal" href="Cryogenics-Ltd-Helium-Level-Gauge.html">Helium Level Gauge (Cryogenics Ltd)</a></li>
<li class="toctree-l3"><a class="reference internal" href="HLM-General.html">Helium Level Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="ICE-Dilution-Fridge.html">ICE Dilution Fridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="ITC-503.html">ITC503</a></li>
<li class="toctree-l3"><a class="reference internal" href="ITC503-Heliox.html">ITC503 (Old-style Heliox)</a></li>
<li class="toctree-l3"><a class="reference internal" href="Mercury-Heliox.html">Oxford Instruments Mercury Heliox</a></li>
<li class="toctree-l3"><a class="reference internal" href="MercuryiTC.html">Mercury iTC</a></li>
<li class="toctree-l3"><a class="reference internal" href="MercuryiTC-Enhanced-Cryostat-Control.html">Mercury iTC - Enhanced cryostat control</a></li>
<li class="toctree-l3"><a class="reference internal" href="Oxford-Instruments-IPS.html">IPS</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Mercury IPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="Triton.html">Triton</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../DAE-and-the-ICP.html">DAE (Data Acquisition Electronics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DAQ.html">DAQ (NI cDAQ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Datastreaming.html">Data Streaming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Fluxgates.html">Fluxgates &amp; Magnetometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Gas-And-Liquid-Handling-Systems.html">Gas and liquid handling systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Imaging-Cameras.html">Imaging Cameras</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Loading-Rigs.html">Loading rigs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Magnets.html">Magnets &amp; Large Power Supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Motors.html">Motors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Motors-Extensions.html">Motor Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Multimeters.html">Multimeters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Other.html">Other / Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PLCs.html">PLCs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Polarisers-and-Analysers.html">Polarisers &amp; Analysers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Power-Distribution-Unit-%28PDU%29.html">Power distribution units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Power-Supplies.html">Power supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Pressure-Monitors.html">Pressure monitors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Reflectometry-IOC.html">Reflectometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Rheometers.html">Rheometers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Sample-Changers.html">Sample Changers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Sensors.html">Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Signal-Generators.html">Signal Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Temperature-Controllers.html">Temperature Controllers</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Processes &amp; Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Providing-Support.html">Providing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Deployment.html">Releases &amp; Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Processes.html">Processes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">IBEX Developer's Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../Specific-IOCs.html">Specific Devices &amp; IOCs</a></li>
          <li class="breadcrumb-item"><a href="../Cryogenics.html">Cryogenics</a></li>
      <li class="breadcrumb-item active">Mercury IPS</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/ibex_developers_manual/blob/master/doc/specific_iocs/cryogenics/Oxford-Instruments-Mercury-IPS.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="mercury-ips">
<h1>Mercury IPS<a class="headerlink" href="#mercury-ips" title="Link to this heading"></a></h1>
<p>The Oxford Instruments Mercury IPS is a superconducting magnet power supply. It is the successor to
the <a class="reference internal" href="Oxford-Instruments-IPS.html"><span class="doc std std-doc">IPS</span></a>. Much of the information on the IPS wiki page also applies to the Mercury IPS.</p>
<section id="scpi-protocol">
<h2>SCPI Protocol<a class="headerlink" href="#scpi-protocol" title="Link to this heading"></a></h2>
<p>The IPS IOC now supports the SCPI protocol, which is more feature rich than Legacy mode.</p>
<p>SCPI mode keeps the same PV interface used by the older IPS units wherever possible, to minimise the
changes required to instrument python scripts when swapping between old &amp; new controllers.
The SNL state machine logic is identical between SCPI &amp; legacy mode.</p>
<p>As already mentioned, SCPI mode provides additional status reporting, much of which is based on the
return string from the <code class="docutils literal notranslate"><span class="pre">READ:SYS:ALRM</span></code> command, which is poorly documented in the supplier’s
documentation. The status strings are assumed to all conform to the “Directory of Alarms” section
(17.3) of the Operator’s Manual (Issue 20, July 2018).
Whilst many of the system alarms that we could test, mostly conformed, some differences were
noticed, along with additional, undocumented status, such as “Magnet Safety”.
It has not been possible to test all alarm scenarios with the IPS unit. Some messages are
undocumented and were ‘discovered’. Our best guess is that the IPS Manual presents some level of
truth, but as such it has not been possible to fully ascertain that all the expected message
strings are correct - they may need to be adjusted later on, if/when they arise.</p>
<p>Tested and verified to date:</p>
<ul class="simple">
<li><p>PSU board open circuit</p></li>
<li><p>PSU board short circuit</p></li>
<li><p>Temperature board open circuit</p></li>
<li><p>Temperature board short circuit</p></li>
</ul>
<p>The support module exports an aSub record subroutine to facilitate handling of the responses to
<code class="docutils literal notranslate"><span class="pre">READ:SYS:ALRM</span></code>, which is not feasible with a StreamDevice protocol handler.
See the section on <a class="reference internal" href="#system-alarms">System Alarms</a> below for more details.</p>
<section id="control-and-control-sp">
<h3>CONTROL and CONTROL:SP<a class="headerlink" href="#control-and-control-sp" title="Link to this heading"></a></h3>
<p>These records have been removed from the SCPI variant database
as the SCPI command set does not manage the panel lock in the same was as legacy and
Magnet Group advised to remove this feature, as they always want to be able to control
the IPS via the front panel.</p>
</section>
<section id="system-hwfault-status-is-derived-from-the-status-bits-via-a-calc-record">
<h3>SYSTEM:HWFAULT status is derived from the status bits via a calc record.<a class="headerlink" href="#system-hwfault-status-is-derived-from-the-status-bits-via-a-calc-record" title="Link to this heading"></a></h3>
<p>This collates the various possible hardware faults into a single record,
which in the legacy protocol is a single value (<code class="docutils literal notranslate"><span class="pre">Xm</span></code> bit 4).</p>
</section>
<section id="sweepmode-params-and-sweepmode-sweep">
<h3>SWEEPMODE:PARAMS and SWEEPMODE:SWEEP<a class="headerlink" href="#sweepmode-params-and-sweepmode-sweep" title="Link to this heading"></a></h3>
<p>These records have been removed as they are meaningless and underivable in SCPI protocol.</p>
</section>
<section id="sweepmode-sweep">
<h3>_SWEEPMODE:SWEEP<a class="headerlink" href="#sweepmode-sweep" title="Link to this heading"></a></h3>
<p>In the legacy version, this used to be the readback from <code class="docutils literal notranslate"><span class="pre">n</span></code> of <code class="docutils literal notranslate"><span class="pre">Mmn</span></code> part of Examine command
return.</p>
<ul class="simple">
<li><p>0 output constant</p></li>
<li><p>1, 2, 3 output changing</p></li>
</ul>
<p>The SCPI protocol doesn’t directly offer this, so it has to be derived via the <code class="docutils literal notranslate"><span class="pre">ACTIVITY</span></code> record
(<code class="docutils literal notranslate"><span class="pre">DEV:GRPZ:PSU:ACTN</span></code>)<br />
Direction from Alex Jones: “A response of <code class="docutils literal notranslate"><span class="pre">HOLD</span></code> or <code class="docutils literal notranslate"><span class="pre">CLMP</span></code> would be equivalent to <code class="docutils literal notranslate"><span class="pre">n=0</span></code> in the
response of the <code class="docutils literal notranslate"><span class="pre">X</span></code> command in the old protocol. Responses of <code class="docutils literal notranslate"><span class="pre">RTOS</span></code> or <code class="docutils literal notranslate"><span class="pre">RTOZ</span></code> would be equivalent to
<code class="docutils literal notranslate"><span class="pre">n=1</span></code>.
There is no equivalent for the <code class="docutils literal notranslate"><span class="pre">m=0,1</span></code> fast/slow ramps, but we do not use this feature anyway.”</p>
</section>
<section id="system-alarms">
<h3>System Alarms<a class="headerlink" href="#system-alarms" title="Link to this heading"></a></h3>
<p>System alarms are derived by interrogating the IPS with the <code class="docutils literal notranslate"><span class="pre">READ:SYS:ALRM?</span></code> SCPI command.
This returns a comma-separated string of active alarms, or an empty string if no alarms are present.
The string is parsed by an aSub record, which sets the relevant bits in a binary register.
The bits are mapped to individual status records, which are then used to set the relevant alarms.
The precise protocol was determined empirically by sending the command and observing the response
directly from the instrument.
Discrete records are generated for each board type and each alarm by the
<code class="docutils literal notranslate"><span class="pre">scpi_system_alarms_discrete.template</span></code> and substitutions files.</p>
<p>The base response is: <code class="docutils literal notranslate"><span class="pre">READ:SYS:ALRM:</span></code> which may (or may not) be followed by a board identifier,
a tab character (9) an alarm string and a semicolon.</p>
<p>In ABNF:<br /></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">response</span>      <span class="o">=</span> <span class="s2">&quot;READ:SYS:ALRM:&quot;</span> <span class="o">*</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="n">error</span>         <span class="o">=</span> <span class="n">board_id</span> <span class="n">TAB</span> <span class="n">error_message</span> <span class="n">SEMICOLON</span>

<span class="n">board_id</span>      <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="n">ALPHA</span> <span class="o">/</span> <span class="n">DIGIT</span> <span class="o">/</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>       <span class="p">;</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">MB1</span><span class="o">.</span><span class="n">T1</span>
<span class="n">error_message</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="n">ALPHA</span> <span class="o">/</span> <span class="n">DIGIT</span> <span class="o">/</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>       <span class="p">;</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="s2">&quot;Open circuit&quot;</span>
<span class="n">TAB</span>           <span class="o">=</span> <span class="o">%</span><span class="n">x09</span>                          <span class="p">;</span> <span class="n">tab</span> <span class="n">character</span>
<span class="n">SEMICOLON</span>     <span class="o">=</span> <span class="o">%</span><span class="n">x3B</span>                          <span class="p">;</span> <span class="n">semicolon</span> <span class="s2">&quot;;&quot;</span>
</pre></div>
</div>
<p>The board identifiers are provided as macros:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Macro</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BOARDID_MAG</p></td>
<td><p>MB1.T1</p></td>
</tr>
<tr class="row-odd"><td><p>BOARDID_10TMAG</p></td>
<td><p>DB8.T1</p></td>
</tr>
<tr class="row-even"><td><p>BOARDID_PRESS</p></td>
<td><p>DB5.P1</p></td>
</tr>
<tr class="row-odd"><td><p>BOARDID_LEVEL</p></td>
<td><p>DB1.L1</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="development-notes">
<h2>Development Notes:<a class="headerlink" href="#development-notes" title="Link to this heading"></a></h2>
<p>Alex Jones has looked at some of the differences between the SCPI and legacy command set and has
summarised some useful information, as quoted below:
For the quench and overheat status, these (and many other issues) are dealt with by “Alarms” for
the SCPI protocol. See the Magnet board section on p. 162 in Issue 20. These are read by
<code class="docutils literal notranslate"><span class="pre">READ:DEV::PSU:STAT</span></code> in some undefined hex format for just the magnet-related alarms, and
<code class="docutils literal notranslate"><span class="pre">READ:SYS:ALRM</span></code> for a list of everything.</p>
<section id="some-further-information-re-uid-naming">
<h3>Some further information re UID naming:<a class="headerlink" href="#some-further-information-re-uid-naming" title="Link to this heading"></a></h3>
<p>The UIDs can be either the nickname for the card (which we can set to anything we want) or related
to the slot number and signal type. From the spreadsheet, the positional UID for the magnet
temperature sensor will be <code class="docutils literal notranslate"><span class="pre">MB1.T1</span></code>, the UID for the level meter will be <code class="docutils literal notranslate"><span class="pre">DB1.L1</span></code> and the UID for
the magnet supply will be <code class="docutils literal notranslate"><span class="pre">GRPZ</span></code> for all 4 of the systems.
The 10T system will have an additional temperature sensor <code class="docutils literal notranslate"><span class="pre">DB8.T1</span></code> and a pressure sensor <code class="docutils literal notranslate"><span class="pre">DB5.P1</span></code>.</p>
<p>Devices connected to the motherboard are prefixed: <code class="docutils literal notranslate"><span class="pre">MB1</span></code><br />
Devices connected to a daughter-board are prefixed: <code class="docutils literal notranslate"><span class="pre">DB&lt;slot</span> <span class="pre">#&gt;</span></code></p>
</section>
<section id="a-comparison-of-availability-of-legacy-vs-scpi-features">
<h3>A comparison of availability of legacy vs SCPI features<a class="headerlink" href="#a-comparison-of-availability-of-legacy-vs-scpi-features" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Legacy</p></th>
<th class="head"><p>SCPI</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Trip current readback</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">F17</span></code></p></td>
<td><p>Not available</p></td>
</tr>
<tr class="row-odd"><td><p>Trip field readback</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">F19</span></code></p></td>
<td><p>Not available</p></td>
</tr>
<tr class="row-even"><td><p>Ramp mode reporting (fast/slow)</p></td>
<td><p>Yes</p></td>
<td><p>Not available</p></td>
</tr>
<tr class="row-odd"><td><p>Status reporting</p></td>
<td><p>Yes</p></td>
<td><p>Detailed</p></td>
</tr>
<tr class="row-even"><td><p>He Level reporting</p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>N2 Level reporting</p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>Pressure reporting</p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>Front panel control lock</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
</section>
<section id="psu-status">
<h3>PSU Status:<a class="headerlink" href="#psu-status" title="Link to this heading"></a></h3>
<p>Using the SCPI command: <code class="docutils literal notranslate"><span class="pre">READ:DEV:&lt;UID&gt;:PSU:STAT</span></code><br />
It is important to note that the STATus word should be examined at the group device level,
not the individual PSU level.<br />
It is also very important to mask out (ignore) all other bits in this 32-bit word (i.e. ones
not defined in the list given below):\</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Status</p></th>
<th class="head"><p>Bit value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Switch Heater Mismatch</p></td>
<td><p>00000001</p></td>
</tr>
<tr class="row-odd"><td><p>Over Temperature [Sense Resistor]</p></td>
<td><p>00000004</p></td>
</tr>
<tr class="row-even"><td><p>Over Temperature [Rundown Resistors]</p></td>
<td><p>00000002</p></td>
</tr>
<tr class="row-odd"><td><p>Over Temperature [PCB]</p></td>
<td><p>00000008</p></td>
</tr>
<tr class="row-even"><td><p>Calibration Failure</p></td>
<td><p>00000010</p></td>
</tr>
<tr class="row-odd"><td><p>MSP430 Firmware Error</p></td>
<td><p>00000020</p></td>
</tr>
<tr class="row-even"><td><p>Rundown Resistors Failed</p></td>
<td><p>00000040</p></td>
</tr>
<tr class="row-odd"><td><p>MSP430 RS-485 Failure</p></td>
<td><p>00000080</p></td>
</tr>
<tr class="row-even"><td><p>Quench detected</p></td>
<td><p>00000100</p></td>
</tr>
<tr class="row-odd"><td><p>Catch detected</p></td>
<td><p>00000200</p></td>
</tr>
<tr class="row-even"><td><p>Over Temperature [Sense Amplifier]</p></td>
<td><p>00001000</p></td>
</tr>
<tr class="row-odd"><td><p>Over Temperature [Amplifier 1]</p></td>
<td><p>00002000</p></td>
</tr>
<tr class="row-even"><td><p>Over Temperature [Amplifier 2]</p></td>
<td><p>00004000</p></td>
</tr>
<tr class="row-odd"><td><p>PWM Cutoff</p></td>
<td><p>00008000</p></td>
</tr>
<tr class="row-even"><td><p>Voltage ADC error</p></td>
<td><p>00010000</p></td>
</tr>
<tr class="row-odd"><td><p>Current ADC error</p></td>
<td><p>00020000</p></td>
</tr>
</tbody>
</table>
</section>
<section id="compromises-with-scpi-command-set-and-epics">
<h3>Compromises with SCPI command set and EPICS<a class="headerlink" href="#compromises-with-scpi-command-set-and-epics" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">STS:SYSTEM:LIMIT</span></code><br />
Is an <code class="docutils literal notranslate"><span class="pre">mbbi</span></code> and has has 5 possible values:\</p>
<ul class="simple">
<li><p>0: “Normal”</p></li>
<li><p>1: “On +ve V Limit”</p></li>
<li><p>2: “On -ve V Limit”</p></li>
<li><p>4: “Current too -ve”</p></li>
<li><p>8: “Current too +ve”</p></li>
</ul>
<p>The limit flags came from the legacy command: <code class="docutils literal notranslate"><span class="pre">Xmn</span></code>
with the index denoted by the <code class="docutils literal notranslate"><span class="pre">n</span></code> value.
SCPI does not provide this information.</p>
</section>
</section>
<section id="ioc-test-framework">
<h2>IOC Test Framework:<a class="headerlink" href="#ioc-test-framework" title="Link to this heading"></a></h2>
<p>With support for the new SCPI based IPS command set, there are now two sets of StreamDevice
protocols. The appropriate protocol is implemented by use of a macro
(<code class="docutils literal notranslate"><span class="pre">PROTOCOL</span></code> = <code class="docutils literal notranslate"><span class="pre">SCPI</span></code> | <code class="docutils literal notranslate"><span class="pre">LEGACY</span></code>) defined prior to running the IOC.</p>
<p>The test framework has been adapted by splitting the existing legacy tests into common tests
and tests specific to either control interface. For instance, the legacy command set knows
nothing about cryogen levels, which the SCPI command set does.</p>
<p>The IOC support provides two protocol files:</p>
<ul class="simple">
<li><p>Legacy: OxInstIPS.protocol</p></li>
<li><p>SCPI: OxInstIPS_SCPI.protocol</p></li>
</ul>
<p>The lewis emulator and IOC test framework for the Mercury IPS is located within the IPS support
module. Manually running the tests is achievable using the following approach:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cd</span></code> to <code class="docutils literal notranslate"><span class="pre">C:\Instrument\Apps\EPICS\support\IPS\master\system_tests</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run_tests.bat</span> <span class="pre">-t</span> <span class="pre">ips_scpi</span> <span class="pre">-a</span> <span class="pre">-f</span></code> - this will run all the SCPI specific tests</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run_tests.bat</span> <span class="pre">-t</span> <span class="pre">ips</span> <span class="pre">-a</span> <span class="pre">-f</span></code> - this will run all the legacy specific tests</p></li>
<li><p>To run a specific test, use something like: <code class="docutils literal notranslate"><span class="pre">run_tests.bat</span> <span class="pre">-t</span> <span class="pre">ips_scpi.test_WHEN_inductance_set_via_backdoor_THEN_value_in_ioc_updates_0__0_12345</span> <span class="pre">-a</span> <span class="pre">-f</span></code></p></li>
</ol>
<ul class="simple">
<li><p>Note that the -a flag simply prompts as to whether to run tests or simply run the emulator.</p></li>
<li><p>The -f flag forces a fast fail on error and no further tests are run.</p></li>
</ul>
</section>
<section id="related-documentation">
<h2>Related Documentation:<a class="headerlink" href="#related-documentation" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://isiscomputinggroup.github.io/ibex_developers_manual/specific_iocs/cryogenics/Oxford-Instruments-IPS.html">Oxford Instruments IPS</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Oxford-Instruments-IPS.html" class="btn btn-neutral float-left" title="IPS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Triton.html" class="btn btn-neutral float-right" title="Triton" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Feb 27, 2026.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>