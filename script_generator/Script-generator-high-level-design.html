

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Script Generator Design &mdash; IBEX Developer&#39;s Manual</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=e6a88b47" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Scripting (Python)" href="../Scripting.html" />
    <link rel="prev" title="Script Generator testing" href="Script-Generator-Testing-Environment.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >

          
          
          <a href="../index.html" class="icon icon-home">
            IBEX Developer's Manual
              <img src="../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Overview.html">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Editing-the-Wiki.html">Editing this Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Interfaces &amp; Scripting</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Client.html">IBEX GUI (Eclipse)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Script-Generator.html">Script Generator</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Gotchas-and-Troubleshooting-for-The-IBEX-Script-Generator.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="IBEX-Script-Generator-Dynamic-Scripting.html">Dynamic Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="Script-Generator-Testing-Environment.html">Script Generator testing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Script Generator Design</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Scripting.html">Scripting (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Web.html">Web Dashboard &amp; Chat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IBEX Server &amp; Systems</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../System-components.html">Backend System Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../IOCs.html">EPICS IOCs &amp; Support Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Specific-IOCs.html">Specific Devices &amp; IOCs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Systems.html">Systems Administration &amp; Hardware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Processes &amp; Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Providing-Support.html">Providing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Deployment.html">Releases &amp; Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Processes.html">Processes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBEX Developer's Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../Script-Generator.html">Script Generator</a></li>
      <li class="breadcrumb-item active">Script Generator Design</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/ibex_developers_manual/blob/master/doc/script_generator/Script-generator-high-level-design.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="script-generator-design">
<h1>Script Generator Design<a class="headerlink" href="#script-generator-design" title="Link to this heading"></a></h1>
<p>Meeting to discuss this happened. Summary of the main points that were discussed is below:</p>
<section id="high-level-design">
<h2>High level design<a class="headerlink" href="#high-level-design" title="Link to this heading"></a></h2>
<p>A high level design to use <strong>Eclipse RCP</strong> was agreed. We will build this in two configurations:</p>
<ul class="simple">
<li><p>As a perspective in the IBEX GUI, similar to other existing perspectives</p></li>
<li><p>As a standalone application <br>
<strong>Note:</strong> these two configurations will be using the same code (except for build-specific files).</p></li>
</ul>
<p>The following general design points were agreed:</p>
<ul class="simple">
<li><p>The GUI will be written in Java (eclipse rcp). It should have minimal logic in it other than pure display logic</p></li>
<li><p>It will talk to a python process embedded in the GUI, whose responsibility it is to generate a python script based on the input that a user has provided</p>
<ul>
<li><p>Py4j is already included in our GUI build and allows for Java-Python communication</p></li>
<li><p>We need this process to be implemented in Python because it needs to be able to run arbitrary user-supplied python parameter validators (see also “The <code class="docutils literal notranslate"><span class="pre">ScriptDefinition</span></code> class”, below).</p></li>
</ul>
</li>
</ul>
</section>
<section id="scriptgenerator-script-definition">
<h2>The <code class="docutils literal notranslate"><span class="pre">ScriptDefinition</span></code> class<a class="headerlink" href="#scriptgenerator-script-definition" title="Link to this heading"></a></h2>
<p>Scientist defined script definitions must be python 2/3 compatible to work with genie python currently.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">ScriptDefinition</span></code> is the base building block that the script generator will use to build up scripts. It is essentially a wrapper around a Python function that can tell us:</p>
<ul class="simple">
<li><p>Whether a given set of inputs is valid</p></li>
<li><p>The types of the parameters</p></li>
<li><p>How long each action will take (optionally)</p></li>
<li><p>Possibly other metadata in future</p></li>
</ul>
<p>As an example, consider a class that looks something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">genie_python.genie_script_generator</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScriptDefinition</span><span class="p">,</span> <span class="n">cast_parameters_to</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mytype</span><span class="p">(</span><span class="n">string_input</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">string_input</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">string_input</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DoRun</span><span class="p">(</span><span class="n">ScriptDefinition</span><span class="p">):</span>

    <span class="nd">@cast_parameters_to</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">uamps</span><span class="o">=</span><span class="n">mytype</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">uamps</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">cset</span><span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">cset</span><span class="p">(</span><span class="s2">&quot;field&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">waitfor_uamps</span><span class="p">(</span><span class="n">uamps</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>

    <span class="nd">@cast_parameters_to</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">uamps</span><span class="o">=</span><span class="n">mytype</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">uamps</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.1</span> <span class="o">&lt;=</span> <span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mi">300</span><span class="p">:</span>
            <span class="n">errors</span> <span class="o">+=</span> <span class="s2">&quot;Temperature outside range</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="o">-</span><span class="mi">5</span> <span class="o">&lt;=</span> <span class="n">field</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">errors</span> <span class="o">+=</span> <span class="s2">&quot;Field outside range&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="o">-</span><span class="mi">20</span> <span class="o">&lt;=</span> <span class="n">uamps</span> <span class="o">&lt;=</span><span class="mi">32</span><span class="p">:</span>
            <span class="n">errors</span> <span class="o">+=</span> <span class="s2">&quot;uamps outside of range&quot;</span>
        <span class="k">if</span> <span class="n">errors</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">errors</span>
        <span class="k">return</span> <span class="kc">None</span>   

    <span class="k">def</span><span class="w"> </span><span class="nf">get_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Help string&quot;</span>
    
    <span class="nd">@cast_parameters_to</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">uamps</span><span class="o">=</span><span class="n">mytype</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">estimate_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">uamps</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">temperature</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">uamps</span> <span class="o">*</span> <span class="mi">100</span> 
</pre></div>
</div>
<p>(this is not necessarily the final API)</p>
<p>We would probably supply some default <code class="docutils literal notranslate"><span class="pre">ScriptDefinition</span></code>s, but instrument scientists would be responsible for writing and maintaining their own instrument-specific script definitions (in a similar way to the current instrument scripts).</p>
<p>Currently, a default value has to be provided for every argument of <code class="docutils literal notranslate"><span class="pre">parameters_valid</span></code> and <code class="docutils literal notranslate"><span class="pre">run</span></code> due to the way we are passing kwargs. The parameters that are passed are all currently strings and must be converted to whatever type the user wants. We are providing a decorator <code class="docutils literal notranslate"><span class="pre">cast_parameters_to</span></code> to allow scientists to easily cast parameters and also define their own converters (see example <code class="docutils literal notranslate"><span class="pre">mytype</span></code> above). The custom converters means they can handle edge cases they are expecting from users.</p>
<p>The default values are used by the script generator to populate initial values for an action. However, this does not rely on the presence of a default value. In the absence of a default value the default is set to the name of the parameter.</p>
</section>
<section id="user-interface">
<h2>User interface<a class="headerlink" href="#user-interface" title="Link to this heading"></a></h2>
<p>There are two main types of user interfaces that support slightly different workflows. We have decided that we will eventually need to support both, but as part of the MVP we should only implement the table-based view.</p>
<section id="table-based-part-of-mvp">
<h3>Table based (part of MVP)<a class="headerlink" href="#table-based-part-of-mvp" title="Link to this heading"></a></h3>
<p>This interface is a simple table. It is configured for one (and only one) type of <code class="docutils literal notranslate"><span class="pre">ScriptDefinition</span></code>. It configures it’s columns to match the parameters of the script definition.</p>
<p>For example, for the <code class="docutils literal notranslate"><span class="pre">ScriptDefinition</span></code> given above, the table in the script generator would look like this:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>temperature</p></th>
<th class="head"><p>field</p></th>
<th class="head"><p>uamps</p></th>
<th class="head"><p>Validity</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>50.0</p></td>
<td><p>-1</p></td>
<td><p>100</p></td>
<td><p>✘</p></td>
</tr>
<tr class="row-odd"><td><p>80.0</p></td>
<td><p>2</p></td>
<td><p>100</p></td>
<td><p>✔</p></td>
</tr>
</tbody>
</table>
<p>Each row in the table corresponds to exactly one <code class="docutils literal notranslate"><span class="pre">Action</span></code>. The type of action must be the same for all rows (otherwise, the columns would no longer make sense).</p>
<p>A row will be highlighted red if invalid and have a heavy cross mark against it in the validity column. If the row is valid it will be the regular table colour with a validity column cell that is green and has a heavy tick mark.</p>
<p>A user is able to get the reason for invalidity (provided by the script definition) by hovering over the row or by clicking the ‘Get Invalidity Errors’ button.</p>
</section>
<section id="list-tree-view-not-part-of-mvp-but-likely-to-be-requested-in-future">
<h3>List/tree view (not part of MVP, but likely to be requested in future)<a class="headerlink" href="#list-tree-view-not-part-of-mvp-but-likely-to-be-requested-in-future" title="Link to this heading"></a></h3>
<p>This interface is a list of Actions and their parameters. In this UI, each action can be of a different type. The actions are executed sequentially. This is a more flexible approach, however it looks closer to the final python script, so is slightly more complex to use (as a user) than the table-based approach. The UI would look more like a set of bullet points:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">doRun</span> <span class="pre">-</span> <span class="pre">temperature=50,</span> <span class="pre">field=5,</span> <span class="pre">uamps=100</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">changeSomething</span> <span class="pre">-</span> <span class="pre">value=1000</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">doRun</span> <span class="pre">-</span> <span class="pre">temperature=100,</span> <span class="pre">field=5,</span> <span class="pre">uamps=100</span></code></p></li>
</ul>
<p>In this sense, it is quite a thin wrapper over a python script. The main advantage it gives you is parameter type/value checking (and arguably. In future we may be able to extend this approach to allow for loops or other types of more complex statements.</p>
</section>
</section>
<section id="script-definitions">
<h2>Script Definitions<a class="headerlink" href="#script-definitions" title="Link to this heading"></a></h2>
<p>The script generator will be configured by loading in a script definition file. This script definition file can initially be written in Python - though we have not necessarily ruled out moving to another format in future if the need arises.</p>
<p>This script definition file will define the available <code class="docutils literal notranslate"><span class="pre">Action</span></code>s, and will be editable by the instrument scientists. Each instrument that uses the script generator will need at least one script definition file (maybe more if they have different experimental setups which require very different scripts).</p>
<section id="workflow-for-editing-script-definitions">
<h3>Workflow for editing script definitions<a class="headerlink" href="#workflow-for-editing-script-definitions" title="Link to this heading"></a></h3>
<p>The workflow for creating or modifying script definitions is:</p>
<ol class="arabic simple">
<li><p>The instrument scientist creates a new or edits an existing a script definition using a text editor (e.g. Notepad++).</p></li>
<li><p>The instrument scientist saves the script definition:</p>
<ol class="arabic simple">
<li><p>if using his/her office (or cabin or home) PC, the script is saved locally (to a directory of the scientist’s choosing)</p></li>
<li><p>if using the instrument control PC, the script is saved <code class="docutils literal notranslate"><span class="pre">&lt;where?&gt;</span></code> (to a directory of the scientist’s choosing?)</p></li>
</ol>
</li>
<li><p>The instrument scientist transfers the saved script definition to the script definition repository.</p>
<ul class="simple">
<li><p>the scientist will use a command (in practice a python or batch script) to perform the transfer</p></li>
<li><p>the command will print a message to inform the instrument scientist of success or failure of the save operation</p></li>
</ul>
</li>
<li><p>If the transfer:</p>
<ol class="arabic simple">
<li><p>succeeds: the scientist need do nothing more</p></li>
<li><p>fails: the scientist should contact the Experiment Controls group for support.</p></li>
</ol>
</li>
</ol>
<p>Notes:</p>
<ol class="arabic simple">
<li><p>We expect instrument scientists to create/modify script definitions.  We do not expect users to create/modify script definitions.  We should advise instrument scientists not to allow users to create/modify script definitions.</p></li>
<li><p>We will create a python/batch script to manage transfer of saved scripts to the git repository</p></li>
<li><p>We will prevent instrument scientists from committing as <code class="docutils literal notranslate"><span class="pre">spudulike</span></code>, the script will have to ask for a username (e.g. <code class="docutils literal notranslate"><span class="pre">fedID</span></code>) and password to commit with</p></li>
<li><p>Script will generate a commit message that identifies that the push was done by the script (i.e. to help us to identify situations in which someone has tried to circumvent the script by using git commands directly)</p></li>
<li><p>Script will prevent the user from setting username and password to use all the time for pushing to this repository</p></li>
<li><p>The script will do: pull, add, commit and push to master</p></li>
<li><p>Must have git and python installed</p></li>
<li><p>Must have access to repository origin</p></li>
</ol>
</section>
<section id="how-script-definitions-repo-is-updated-on-start">
<h3>How Script Definitions Repo is Updated on Start<a class="headerlink" href="#how-script-definitions-repo-is-updated-on-start" title="Link to this heading"></a></h3>
<p><img alt="" src="../_images/UpdateRepoFlowDiagram.png" /></p>
<p>On start up we want to get the current repository of script if possible and the user lets us. If there is a problem because they have edited their code in the repository we assume this is because they know what they are doing. To edit the code they will need to know how to commit it back to the central repo anyway so we don’t need to cover that case except to warn them (they are power users). For normal users they just want it up-to-date or not.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Script-Generator-Testing-Environment.html" class="btn btn-neutral float-left" title="Script Generator testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../Scripting.html" class="btn btn-neutral float-right" title="Scripting (Python)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Oct 31, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>