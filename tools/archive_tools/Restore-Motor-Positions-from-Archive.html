

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Restore motor positions from archive &mdash; IBEX Developer&#39;s Manual</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=e6a88b47" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Archive Rates" href="archive-rates.html" />
    <link rel="prev" title="Archive Time Log" href="Archive-Time-Log.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >

          
          
          <a href="../../index.html" class="icon icon-home">
            IBEX Developer's Manual
              <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Overview.html">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Editing-the-Wiki.html">Editing this Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Interfaces &amp; Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Client.html">IBEX GUI (Eclipse)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Script-Generator.html">Script Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Scripting.html">Scripting (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Web.html">Web Dashboard &amp; Chat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IBEX Server &amp; Systems</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../System-components.html">Backend System Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../IOCs.html">EPICS IOCs &amp; Support Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Specific-IOCs.html">Specific Devices &amp; IOCs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Processes &amp; Tools</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Providing-Support.html">Providing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Deployment.html">Releases &amp; Deployment</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../Tools.html">Tools</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../Archive-Tools.html">Archive Tools</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Archive-Event-Log.html">Archive Event Log</a></li>
<li class="toctree-l3"><a class="reference internal" href="Archive-Time-Log.html">Archive Time Log</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Restore motor positions from archive</a></li>
<li class="toctree-l3"><a class="reference internal" href="archive-rates.html">Archive Rates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../CA-snooper.html">CA snooper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Check-db-file.html">Check db file script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Common-config-upgrade-steps.html">Common config upgrade steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Config-Checker.html">Config Checker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Config-IOC-Finder.html">Config IOC Finder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Config-Upgrader.html">Config Upgrader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Moxa-Tools.html">Moxa Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Shared-utility-scripts.html">Shared Utility Scripts (<code class="docutils literal notranslate"><span class="pre">ibex_utils</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Processes.html">Processes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">IBEX Developer's Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../Tools.html">Tools</a></li>
          <li class="breadcrumb-item"><a href="../Archive-Tools.html">Archive Tools</a></li>
      <li class="breadcrumb-item active">Restore motor positions from archive</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/ibex_developers_manual/blob/master/doc/tools/archive_tools/Restore-Motor-Positions-from-Archive.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="restore-motor-positions-from-archive">
<h1>Restore motor positions from archive<a class="headerlink" href="#restore-motor-positions-from-archive" title="Link to this heading"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Edge case: If you are applying positions obtained with this script via SECI, be careful as the user offsets may be different for each axis i.e. the difference needs to be added to the recovered position.</p>
</div>
<p>This tool can be used to restore motor positions from the archive and put them on the current motor axis. It works by running in an epics terminal the commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Instrument</span>\<span class="n">Apps</span>\<span class="n">EPICS</span>\<span class="n">ISIS</span>\<span class="n">inst_servers</span>\<span class="n">master</span>\<span class="n">scripts</span>
<span class="o">%</span><span class="n">PYTHON3</span><span class="o">%</span> <span class="n">restore_motor_positions</span><span class="o">.</span><span class="n">py</span> <span class="o">&lt;</span><span class="n">arguments</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The arguments are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Find</span> <span class="n">positions</span> <span class="n">of</span> <span class="n">motors</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">past</span> <span class="ow">and</span> <span class="n">restore</span> <span class="n">those</span> <span class="n">to</span> <span class="n">current</span> <span class="n">positions</span> <span class="o">--</span><span class="n">time</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span><span class="n">T09</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">--</span><span class="n">host</span> <span class="n">ndximat</span>
<span class="o">--</span><span class="n">prefix</span> <span class="n">IN</span><span class="p">:</span><span class="n">IMAT</span><span class="p">:</span> <span class="o">--</span><span class="n">controller</span> <span class="mi">01</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">time</span> <span class="n">TIME</span><span class="p">,</span> <span class="o">-</span><span class="n">t</span> <span class="n">TIME</span>  <span class="n">Time</span> <span class="n">to</span> <span class="n">restore</span> <span class="kn">from</span><span class="w"> </span><span class="nn">iso</span> <span class="n">date</span><span class="p">,</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="n">T16</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">02</span>
  <span class="o">--</span><span class="n">host</span> <span class="n">HOST</span>           <span class="n">Host</span> <span class="n">to</span> <span class="n">get</span> <span class="n">data</span> <span class="kn">from</span><span class="w"> </span><span class="nn">defaults</span> <span class="n">to</span> <span class="n">localhost</span>
  <span class="o">--</span><span class="n">prefix</span> <span class="n">PREFIX</span><span class="p">,</span> <span class="o">-</span><span class="n">p</span> <span class="n">PREFIX</span>
                        <span class="n">Prefix</span> <span class="k">for</span> <span class="n">motor</span> <span class="n">controller</span><span class="p">,</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">specified</span> <span class="n">current</span> <span class="n">instrument</span><span class="o">.</span>
  <span class="o">--</span><span class="n">controller</span> <span class="n">CONTROLLER</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="n">CONTROLLER</span>
                        <span class="n">Controller</span> <span class="n">number</span><span class="p">,</span> <span class="k">for</span> <span class="n">single</span> <span class="n">controller</span> <span class="n">get</span>
</pre></div>
</div>
<p>When it is run it will look at the database at the time you have requested and find the first point before this, it will then look 1 hour into the future and find when the motor next moves. It will then print this as a summary table for you to look at, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span>         <span class="n">motor</span>  <span class="p">:</span> <span class="n">db</span> <span class="n">value</span>     <span class="n">diff</span> <span class="kn">from</span><span class="w">    </span><span class="o">-</span> <span class="n">last</span> <span class="n">update</span>         <span class="nb">next</span> <span class="n">update</span>         <span class="n">alarm</span>
                    <span class="p">:</span>              <span class="n">current</span> <span class="n">val</span>  <span class="o">-</span> <span class="p">(</span><span class="n">sample</span> <span class="n">time</span><span class="p">)</span>       <span class="p">(</span><span class="n">within</span> <span class="n">window</span><span class="p">)</span>
<span class="n">Coarse</span> <span class="n">North</span> <span class="n">MTR0101</span><span class="p">:</span>       <span class="mf">30.700</span>        <span class="mf">0.000</span> <span class="o">-</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">00</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">01</span> <span class="n">NONE</span>
<span class="n">Coarse</span> <span class="n">East</span>  <span class="n">MTR0102</span><span class="p">:</span>       <span class="mf">89.433</span>        <span class="mf">0.000</span> <span class="o">-</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">58</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">19</span> <span class="o">-</span>                   <span class="n">NONE</span>
<span class="n">Coarse</span> <span class="n">South</span> <span class="n">MTR0103</span><span class="p">:</span>       <span class="o">-</span><span class="mf">1.000</span>        <span class="mf">0.000</span> <span class="o">-</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">58</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">39</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">36</span> <span class="n">NONE</span>
<span class="n">Coarse</span> <span class="n">West</span>  <span class="n">MTR0104</span><span class="p">:</span>       <span class="mf">35.000</span>        <span class="mf">0.000</span> <span class="o">-</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">33</span><span class="o">-</span><span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">53</span> <span class="o">-</span>                   <span class="n">NONE</span>
<span class="n">Gimbal</span> <span class="n">Z</span>     <span class="n">MTR0105</span><span class="p">:</span>      <span class="o">-</span><span class="mf">28.000</span>        <span class="mf">0.000</span> <span class="o">-</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">33</span><span class="o">-</span><span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">53</span> <span class="o">-</span>                   <span class="n">NONE</span>
<span class="n">Gimbal</span> <span class="n">Theta</span> <span class="n">MTR0106</span><span class="p">:</span>       <span class="mf">10.000</span>        <span class="mf">0.000</span> <span class="o">-</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">33</span><span class="o">-</span><span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">53</span> <span class="o">-</span>                   <span class="n">NONE</span>
<span class="n">Gimbal</span> <span class="n">chi</span>   <span class="n">MTR0107</span><span class="p">:</span>       <span class="mf">10.000</span>        <span class="mf">0.000</span> <span class="o">-</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">33</span><span class="o">-</span><span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">53</span> <span class="o">-</span>                   <span class="n">NONE</span>
<span class="n">Front</span> <span class="n">Guide</span>  <span class="n">MTR0108</span><span class="p">:</span>       <span class="mf">45.000</span>        <span class="mf">0.000</span> <span class="o">-</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">33</span><span class="o">-</span><span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">53</span> <span class="o">-</span>                   <span class="n">NONE</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: name of the motor (description)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">motor</span></code>: is the pv root</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">db</span> <span class="pre">value</span></code>: is the value from the database</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">diff</span> <span class="pre">from</span> <span class="pre">current</span> <span class="pre">value</span></code>: is the difference between the current pv’s value and the db value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last</span> <span class="pre">update</span></code>: is the time at which the sample was requested</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">next</span> <span class="pre">update</span></code>: is the next time the pv changes, <code class="docutils literal notranslate"><span class="pre">-</span></code> means it did not change in the window which is set to be an hour</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alarm</span></code>: is the alarms logged severity in the database</p></li>
</ul>
<p>Once this summary has been printed each motor will be considered in turn and the user can choose to restore or not the positions for that motor. This looks something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       Motor: Coarse North - MTR0101
 Current pos: 30.700000000000003
Recorded pos: 30.700000000000003  (alarm NONE )
  last moved: 2021-02-03 15:00:00.955650  next move 2021-02-03 15:00:01.055938
Set motor to record position? [Y/N]
</pre></div>
</div>
<p>You should check that the motor has not moved for a while and is not moving for a while after this time. If it does move think about plotting the values at that time. You should check that the value is reasonable. If this is good then the position should be restored. If for any reason this fails to set the motor position make sure that the axis motor calibration is set to <code class="docutils literal notranslate"><span class="pre">use</span></code> not <code class="docutils literal notranslate"><span class="pre">set</span></code>.</p>
<p>It should also produce a log in the <code class="docutils literal notranslate"><span class="pre">var\logs</span></code> directory listing the redefines and summary table.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Archive-Time-Log.html" class="btn btn-neutral float-left" title="Archive Time Log" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="archive-rates.html" class="btn btn-neutral float-right" title="Archive Rates" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Feb 27, 2026.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>