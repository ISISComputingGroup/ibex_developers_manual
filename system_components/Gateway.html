

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gateways &mdash; IBEX Developer&#39;s Manual</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=e6a88b47" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="IOC Message Logging" href="IOC-message-logging.html" />
    <link rel="prev" title="Database Server" href="DatabaseServer.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >

          
          
          <a href="../index.html" class="icon icon-home">
            IBEX Developer's Manual
              <img src="../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Overview.html">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Editing-the-Wiki.html">Editing this Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Interfaces &amp; Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Client.html">IBEX GUI (Eclipse)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Script-Generator.html">Script Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Scripting.html">Scripting (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Web.html">Web Dashboard &amp; Chat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IBEX Server &amp; Systems</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../System-components.html">Backend System Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ActiveMQ.html">ActiveMQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="Alarms.html">Alarms</a></li>
<li class="toctree-l2"><a class="reference internal" href="BlockServer.html">BlockServer</a></li>
<li class="toctree-l2"><a class="reference internal" href="CSS-Archive-Engine.html">CS-Studio Archive Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="Central-archiver-appliance.html">Central archiver appliance</a></li>
<li class="toctree-l2"><a class="reference internal" href="DatabaseServer.html">Database Server</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Gateways</a></li>
<li class="toctree-l2"><a class="reference internal" href="IOC-message-logging.html">IOC Message Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="Inst-etc-IOC.html"><code class="docutils literal notranslate"><span class="pre">INSTETC</span></code> IOC</a></li>
<li class="toctree-l2"><a class="reference internal" href="Journal-Viewer.html">Journals</a></li>
<li class="toctree-l2"><a class="reference internal" href="LabVIEW.html">LabVIEW</a></li>
<li class="toctree-l2"><a class="reference internal" href="Logging-from-the-archive.html">Logging from the archive</a></li>
<li class="toctree-l2"><a class="reference internal" href="MySQL-Database.html">MySQL database</a></li>
<li class="toctree-l2"><a class="reference internal" href="Nicos.html">NICOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="PVAccess-gateways-%28p4p%29.html">PVAccess Gateways</a></li>
<li class="toctree-l2"><a class="reference internal" href="Python.html">Python (including Uktena, <code class="docutils literal notranslate"><span class="pre">uv</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Remote-IOCs.html">Remote IOC Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="Run-control.html">Run Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="Settings-and-Configurations.html">Settings &amp; Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Startup-and-Shutdown.html">Startup and Shutdown</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../IOCs.html">EPICS IOCs &amp; Support Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Specific-IOCs.html">Specific Devices &amp; IOCs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Processes &amp; Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Providing-Support.html">Providing Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Deployment.html">Releases &amp; Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Processes.html">Processes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBEX Developer's Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../System-components.html">Backend System Components</a></li>
      <li class="breadcrumb-item active">Gateways</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/ibex_developers_manual/blob/master/doc/system_components/Gateway.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="gateways">
<h1>Gateways<a class="headerlink" href="#gateways" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>There are two files involved in the gateway, an ACF and a PVLIST. When the start_gateways.bat is run it copies the default files, appends any custom rules for the server stored in <code class="docutils literal notranslate"><span class="pre">settings\config\serverName\AccessSecurity</span></code>, and uses the standard macro expander for IBEX.</p>
<p>The ACF is the rules for the access, while the pvlist specifies which rules to follow for what.</p>
</section>
<section id="acf-files">
<h2>ACF Files<a class="headerlink" href="#acf-files" title="Link to this heading"></a></h2>
<p>The default.acf used by both the external gateway and the IOCs is stored in <code class="docutils literal notranslate"><span class="pre">AccessSecurity</span></code> - these could be diverged if necessary.</p>
<p>The rules for the groups are enacted from bottom to top</p>
<p>It is possible to have lists of users:</p>
<p><code class="docutils literal notranslate"> <span class="pre">UAG(listname)</span> <span class="pre">{</span> <span class="pre">user1,</span> <span class="pre">user2</span> <span class="pre">}</span></code></p>
<p>and lists of hosts/computers:</p>
<p><code class="docutils literal notranslate"><span class="pre">HAG(listname)</span> <span class="pre">{</span> <span class="pre">comp1,</span> <span class="pre">comp2</span> <span class="pre">}</span></code></p>
<p>Within the defaults for IBEX there is:</p>
<p><code class="docutils literal notranslate"><span class="pre">HAG(instmachine)</span> <span class="pre">{</span> <span class="pre">localhost,</span> <span class="pre">$(ACF_IH1=localhost),</span> <span class="pre">$(ACF_IH2=localhost),</span> <span class="pre">$(ACF_IH3=localhost),</span> <span class="pre">$(ACF_IH4=localhost)</span> <span class="pre">}</span></code></p>
<p>The macros would be set via globals.txt and would list the machines which are allowed full control of a server via the external gateway</p>
<p>A security group is set up with a number of rules, an example would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ASG</span><span class="p">(</span><span class="n">securityGroupName</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">INPA</span><span class="p">(</span><span class="s2">&quot;PVNAME&quot;</span><span class="p">)</span>
	<span class="n">RULE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">READ</span><span class="p">)</span>
	<span class="n">RULE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">WRITE</span><span class="p">,</span> <span class="n">TRAPWRITE</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">HAG</span><span class="p">(</span><span class="n">listname</span><span class="p">)</span>
		<span class="n">CALC</span><span class="p">(</span><span class="s2">&quot;A=0&quot;</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above security group would allow the PVs which use it (more on that later) to read from anywhere, but could only be written to by the machines in the list with listname when the specified PV is at 0, any other value for that PV and the write won’t be allowed.</p>
<p>There are 5 ASG lists within IBEX by default at present and they are as follows, note that a write is always a write, trapwrite:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>ASG Name</p></th>
<th class="head"><p>Read Rule</p></th>
<th class="head"><p>Write Rule</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DEFAULT</span></code></p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GWEXT</span></code></p></td>
<td><p>1</p></td>
<td><p>1 for <code class="docutils literal notranslate"><span class="pre">instmachine</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">READONLY</span></code></p></td>
<td><p>1</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">WASL0</span></code></p></td>
<td><p>1</p></td>
<td><p>0 for <code class="docutils literal notranslate"><span class="pre">instmachine</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ANYBODY</span></code></p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<p>There is a standard record always available within IBEX to control via a CALC as per the example above within INSTETC_01. The db entry for that record is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># used for access security on the fly changes</span>
<span class="n">record</span> <span class="p">(</span><span class="n">bo</span><span class="p">,</span> <span class="s2">&quot;$(P)CS:EXCLUSIVE&quot;</span><span class="p">)</span> 
<span class="p">{</span>
	<span class="n">field</span><span class="p">(</span><span class="n">DESC</span><span class="p">,</span> <span class="s2">&quot;Restrict access to localhost&quot;</span><span class="p">)</span>
	<span class="n">field</span><span class="p">(</span><span class="n">SCAN</span><span class="p">,</span> <span class="s2">&quot;Passive&quot;</span><span class="p">)</span>
	<span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;Soft Channel&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">PINI</span><span class="p">,</span> <span class="s2">&quot;YES&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">VAL</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">OMSL</span><span class="p">,</span> <span class="s2">&quot;supervisory&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">ZNAM</span><span class="p">,</span> <span class="s2">&quot;All access&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">ONAM</span><span class="p">,</span> <span class="s2">&quot;Restricted access&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is also possible to generate 4 more (they have the name <span class="math notranslate nohighlight">\((P)CS:EXCLUSIVE\)</span>(ID) in the db entry) using macros EXCLUSIVE1, EXCLUSIVE2, EXCLUSIVE3 and EXCLUSIVE4 which can be set via globals.txt. Note that these entries will need to include a : to use in the ID name, this has been left to implement there as otherwise if for some reason there was an expectation in an ACF for such a macro and it didn’t exist we don’t end up with a PV with nothing after a :.</p>
<p>Should an IBEX server require specific security group settings, then creating a file called <code class="docutils literal notranslate"><span class="pre">gwext.acf</span></code> in the <code class="docutils literal notranslate"><span class="pre">Settings\config\servername\AccessSecurity</span></code> folder will ensure that the gateway loads up with both the default groups, and any groups specified in <code class="docutils literal notranslate"><span class="pre">gwext.acf</span></code>.</p>
<p>An example of a custom acf file would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HAG</span><span class="p">(</span><span class="n">testing</span><span class="p">)</span> <span class="p">{</span> <span class="n">computerName</span> <span class="p">}</span>

<span class="n">ASG</span><span class="p">(</span><span class="n">TESTING</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">INPA</span><span class="p">(</span><span class="s2">&quot;$(MYPVPREFIX)CS:EXCLUSIVE$(EXCLUSIVE1=)&quot;</span><span class="p">)</span>
    <span class="n">RULE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">READ</span><span class="p">)</span>
    <span class="n">RULE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">WRITE</span><span class="p">,</span> <span class="n">TRAPWRITE</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">HAG</span><span class="p">(</span><span class="n">testing</span><span class="p">)</span>
        <span class="n">CALC</span><span class="p">(</span><span class="s2">&quot;A=0&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></div>
</div>
<p>Please note, these specific groups will only be required when WRITE access is needed beyond the standard named machines, and/or must be limited in some fashion. All systems will allow READING of any PV.</p>
</section>
<section id="gateway-pvlist-files">
<h2>PVLIST files<a class="headerlink" href="#gateway-pvlist-files" title="Link to this heading"></a></h2>
<p>These lists allow the gateway to enact rules separately to the security rules being enacted by the IOCs, as well as providing an ability to ALIAS records as well.</p>
<p>As with the ACF there is default file.</p>
<p>It is possible to alter the evaluation order of the pvlist rules, by default within IBEX they are ordered ALLOW, DENY which makes deny rules override allow rules. This should not be changed.</p>
<p>Within the default pvlist there is a rule for all PVs to ALLOW them to a certain security group. The default for this is <code class="docutils literal notranslate"><span class="pre">GWEXT</span></code>. However, there is a macro, <code class="docutils literal notranslate"><span class="pre">$(ACF_PV)</span></code>, which can be used to alter that to a different security group. Please note, setting this macro could have serious repercussions on who has the ability to control (or not) an instrument, and it should generally be left alone.</p>
<p>Should an instrument need a specific pvlist file then there are a few behaviours and formats to be aware of. To provide access to a PV this has to be done via the original PV, you cannot provide access to an alias in these files if the underlying PV is not granted access. However, if the underlying PV has access then so too do any aliases (or at least that is what was observed).</p>
<p>In order to alias a PV the format is:</p>
<p><code class="docutils literal notranslate"><span class="pre">aliasPVname</span> <span class="pre">ALIAS</span> <span class="pre">originalPVname</span></code></p>
<p>e.g. <code class="docutils literal notranslate"><span class="pre">$(MYPVPREFIX)KAUI:EXAMPLE</span>&#160; <span class="pre">ALIAS</span> <span class="pre">$(MYPVPREFIX)SIMPLE:VALUE2</span></code></p>
<p>In order to alias all PVs in an IOC:</p>
<p><code class="docutils literal notranslate"><span class="pre">aliasIOCname\([.:].*\)</span> <span class="pre">ALIAS</span> <span class="pre">originalIOCname\1</span></code></p>
<p>e.g. <code class="docutils literal notranslate"><span class="pre">$(MYPVPREFIX)MIRJANA\([.:].*\)</span> <span class="pre">ALIAS</span>&#160;&#160; <span class="pre">$(MYPVPREFIX)SIMPLE\1</span></code></p>
<p>The .* can be used as a wildcard in these files, and is used rather than specifying $(MYPVPREFIX) in the examples below for brevity.</p>
<p>In order to allow a security group access to a PV:</p>
<p><code class="docutils literal notranslate"><span class="pre">.*pvName</span> <span class="pre">ALLOW</span> <span class="pre">securityGroupName</span> <span class="pre">1</span></code></p>
<p>e.g. ‘.*SIMPLE:VALUE2 ALLOW   TESTING 1’</p>
<p>To allow access to an IOC:</p>
<p><code class="docutils literal notranslate"><span class="pre">.*iocName.*</span> <span class="pre">ALLOW</span> <span class="pre">securityGroupName</span> <span class="pre">1</span></code></p>
<p>e.g. <code class="docutils literal notranslate"><span class="pre">*SIMPLE.*</span> <span class="pre">ALLOW</span>&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">TESTING</span>&#160;&#160;&#160;&#160; <span class="pre">1</span></code></p>
<p>If you are using <code class="docutils literal notranslate"><span class="pre">CS:EXCLUSIVE:</span></code> and a custom <code class="docutils literal notranslate"><span class="pre">.acf</span></code> file, you will also need to create a file called <code class="docutils literal notranslate"><span class="pre">gwext.pvlist</span></code> in <code class="docutils literal notranslate"><span class="pre">Settings\config\servername\AccessSecurity</span></code>. At the end of that file in order for the access security to work remotely, you will need to add:</p>
<p><code class="docutils literal notranslate"><span class="pre">.*CS:EXCLUSIVE.*</span>&#160;&#160;&#160; <span class="pre">ALLOW</span>&#160;&#160; <span class="pre">securityGroupName</span></code></p>
<p>e.g. <code class="docutils literal notranslate"><span class="pre">.*CS:EXCLUSIVE.*</span>&#160;&#160;&#160; <span class="pre">ALLOW</span>&#160;&#160; <span class="pre">TESTING</span></code></p>
<p>If the aim is to deny, simply replace the ALLOW with DENY. Do remember that the standard security groups can be used when writing a pvlist file as well as custom ones.</p>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<section id="printing-reports">
<h3>Printing Reports<a class="headerlink" href="#printing-reports" title="Link to this heading"></a></h3>
<p>In general the gateways are set to low logging levels as they process a lot of PVs and so can be overly chatty. However, if there is an issue with a gateway you can get it to dump a report of it’s state by doing <code class="docutils literal notranslate"><span class="pre">caput</span> <span class="pre">%MYPVPREFIX%CS:GATEWAY:BLOCKSERVER:report2Flag</span> <span class="pre">1</span></code> and similarly for the external gateway. This will report information into <code class="docutils literal notranslate"><span class="pre">Instrument\var\logs\gateway</span></code>. There are 3 different reports that you can print, see <a class="reference external" href="https://epics.anl.gov/EpicsDocumentation/ExtensionsManuals/Gateway/Gateway.html#Report">here</a> but generally report 2 gives a good overview of the state of the gateway.</p>
</section>
</section>
<section id="links">
<h2>Links<a class="headerlink" href="#links" title="Link to this heading"></a></h2>
<p>More information can be found at:</p>
<p><a class="reference external" href="http://www.aps.anl.gov/epics/extensions/gateway/">Gateway: The Process Variable Gateway</a> - the main gateway page</p>
<p><a class="reference external" href="http://www.aps.anl.gov/epics/base/R3-14/12-docs/AppDevGuide/node9.html#SECTION00970000000000000000">8.7 Channel Access Security</a> - Access Security details for channel access</p>
<p><a class="reference external" href="https://epics.anl.gov/bcda/synApps/caputRecorder/caputRecorder.html">caputRecorder 1.4</a> - useful examples for the security groups</p>
<p><a class="reference external" href="http://www.aps.anl.gov/epics/EpicsDocumentation/ExtensionsManuals/Gateway/Gateway.html">Gateway Users Guide</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="DatabaseServer.html" class="btn btn-neutral float-left" title="Database Server" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="IOC-message-logging.html" class="btn btn-neutral float-right" title="IOC Message Logging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Feb 27, 2026.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>