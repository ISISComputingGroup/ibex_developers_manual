# Creating LvDCOM IOCBoot areas

Note on LabVIEW rings: EPICS MBBI record items have a maximum length of 25 characters, if a labview ring item name is longer than this it will be either truncated or have spaces removed in the epics display. This will not stop it working, but it is best to keep names within this 25 character limit if at all possible.

I plan to make these into a template (so you will just need to run makeBaseApp.pl and not do the edits), but for now this is the manual way

First **svn update** and re-run **config_env.bat**

In the **EPICS\ISIS** directory where “myname” is the name of your driver

```
 mkdir myname
 cd myname
 makeBaseApp.pl –t ioc myname
 makeBaseApp.pl –i –t ioc myname
```

Edit **mynameApp/src/build.mak** add

```
$(APPNAME)_DBD += lvDCOM.dbd
```
and
```
$(APPNAME)_LIBS += lvDCOM 
$(APPNAME)_LIBS += asyn 
```

The XML file generated by xsltproc previously should be put into a **mynameApp/protocol** directory and named myname, as well as the .db file being copied into the appropriate mynameApp folder

# John's Attempt (if it works will replace the page)

# Creating LvDCOM IOCBoot areas

Note on LabVIEW rings: EPICS MBBI record items have a maximum length of 25 characters, if a labview ring item name is longer than this it will be either truncated or have spaces removed in the epics display. This will not stop it working, but it is best to keep names within this 25 character limit if at all possible.

I (Freddie?) plan to make these into a template (so you will just need to run makeBaseApp.pl and not do the edits), but for now this is the manual way

In an epics terminal in **EPICS\ISIS** directory where “myname” is the name of your driver

```
 mkdir myname
 cd myname
 makeBaseApp.pl –t ioc myname
 makeBaseApp.pl –i –t ioc myname
```

then **cd configure** and add the following to the end of **RELEASE** (NOTE:Version numbers of ASYN and ONCRPC may need correcting)

```
LVDCOM=$(ISISSUPPORT)/lvDCOM
ASYN=$(SUPPORT)/asyn/4-22
ONCRPC=$(SUPPORT)/oncrpc/2
```

then to **mynameApp/src/build.mak** add

```
$(APPNAME)_LIBS += lvDCOM asyn
$(APPNAME)_SYS_LIBS_WIN32 += msxml2
```

May also need to add

```
$(APPNAME)_DBD += lvDCOM.dbd
```

and 
```
$(APPNAME)_SYS_LIBS_WIN32 += msxml2
amd
$(APPNAME)_LIBS += utilities pcre libjson zlib
```

## Create the xml configuration file

1. Open the VI in lab view.
1. Go to Tools menu, Advanced, Export Strings... and uncheck the wizard option for "block diagram strings" and save the export results to a text file e.g. controls.txt (Note: you may need write access to the VI itself to do this, so might have to make a local copy of the VI first)

1. Generate a correct xml file, in an epics terminal

```
C:\Instrument\Apps\EPICS\ioc\master\ISISSTAT>C:\Instrument\Apps\EPICS\ISIS\lvDCOM\master\lvDCOMApp\src\fix_xml.cmd
"Mercury-Front-Panel-1-Temp 1.txt" "Mercury-Front-Panel-1-Temp 1.xml"
xsltproc C:\Instrument\Apps\EPICS\ISIS\lvDCOM\master\lvDCOMApp\src\lvstrings2input.xsl "Mercury-Front-Panel-1-Temp
1.xml" > lvinput.xml
```

1. edit TODOs in file, remove unneeded controls
1. generate db file
```
xsltproc C:\Instrument\Apps\EPICS\ISIS\lvDCOM\master\lvDCOMApp\src\lvinput2db.xsl lvinput.xml > mercury-front-panel
-1-temp.db
```
1. Copy db file to application Db file
1. Add db file to makefile in

The XML file generated by xsltproc previously should be put into a **mynameApp/protocol** directory and named myname, as well as the .db file being copied into the appropriate mynameApp folder


